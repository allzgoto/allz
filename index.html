<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Shadow Temple Interface — Ink Mode</title>

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700&family=Inter:wght@400;500&display=swap" rel="stylesheet" />

<style>
:root{
  --ink:#05060a;
  --coal:#0b0d12;

  --bone: rgba(245,238,220,.86);
  --bone2: rgba(245,238,220,.62);

  --red: rgba(200,60,60,.55);
  --red2: rgba(200,60,60,.18);

  --line: rgba(255,255,255,.07);

  --txt: rgba(245,248,255,.92);
  --dim: rgba(245,248,255,.62);

  --blur-amount: 26px;

  --shadowA: 0 18px 58px rgba(0,0,0,.58);
  --shadowB: 0 22px 70px rgba(0,0,0,.64);
  --shadowC: 0 12px 44px rgba(0,0,0,.45);

  --radius-lg: 18px;
  --radius-md: 14px;
}

*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%}
body{
  background:var(--ink);
  color:var(--txt);
  font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  overflow:hidden;
}
::selection{background:rgba(200,60,60,.22);}

/* ================= VIDEO ================= */
#videoBlur{
  position:fixed;
  inset:-20%;
  width:140%;
  height:140%;
  object-fit:cover;
  filter: blur(var(--blur-amount)) brightness(.46) saturate(1.02) contrast(1.06);
  transform: translateZ(0);
  z-index:-5;
}
#video{
  position:fixed;
  inset:0;
  width:100%;
  height:100%;
  object-fit:cover;
  z-index:-4;
  background:black;
}

/* ================= OVERLAYS ================= */
.scanlines{
  position:fixed;
  inset:0;
  background:repeating-linear-gradient(
    to bottom,
    rgba(255,255,255,0.02),
    rgba(255,255,255,0.02) 1px,
    transparent 1px,
    transparent 4px
  );
  pointer-events:none;
  z-index:3;
  mix-blend-mode:overlay;
  opacity:.42;
}
#cinemaFX{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:4;
}
#cinemaFX::before{
  content:"";
  position:absolute;
  inset:-20%;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='.35'/%3E%3C/svg%3E");
  opacity:.07;
  mix-blend-mode:overlay;
  animation:grain 6s steps(10) infinite;
}
#cinemaFX::after{
  content:"";
  position:absolute;
  inset:0;
  background:
    radial-gradient(circle at 50% 48%, transparent 0 62%, rgba(0,0,0,.48) 82%, rgba(0,0,0,.78) 100%),
    radial-gradient(circle at 55% 55%, rgba(200,60,60,.04), transparent 55%);
  opacity:.66;
}
@keyframes grain{
  0%{transform:translate(0,0)}
  10%{transform:translate(-2%, -3%)}
  20%{transform:translate(-4%, 2%)}
  30%{transform:translate(3%, -2%)}
  40%{transform:translate(2%, 4%)}
  50%{transform:translate(-3%, 2%)}
  60%{transform:translate(4%, 0%)}
  70%{transform:translate(0%, 3%)}
  80%{transform:translate(-2%, -2%)}
  90%{transform:translate(3%, 1%)}
  100%{transform:translate(0,0)}
}

#glitchFlash{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:60;
  opacity:0;
  background:
    radial-gradient(circle at 50% 50%, rgba(255,255,255,.10), transparent 55%),
    radial-gradient(circle at 50% 55%, rgba(200,60,60,.12), transparent 55%),
    repeating-linear-gradient(0deg, rgba(255,255,255,.05) 0 1px, transparent 1px 5px);
  mix-blend-mode:screen;
}
.glitch-on #glitchFlash{ animation:glitchFlash .55s steps(6) 1; }
@keyframes glitchFlash{
  0%{opacity:0}
  10%{opacity:1; transform:translateX(6px)}
  25%{opacity:.28; transform:translateX(-8px)}
  40%{opacity:1; transform:translateX(4px)}
  60%{opacity:.18; transform:translateX(-4px)}
  80%{opacity:.85; transform:translateX(2px)}
  100%{opacity:0; transform:none}
}

/* ================= PANELS ================= */
.hudPanel, .inkPanel{
  border:1px solid rgba(245,238,220,.10);
  background:
    radial-gradient(circle at 18% 12%, rgba(245,238,220,.08), transparent 55%),
    linear-gradient(180deg, rgba(10,8,7,.62), rgba(0,0,0,.38));
  box-shadow: var(--shadowA), 0 0 0 1px rgba(0,0,0,.30) inset;
  backdrop-filter: blur(14px);
  position:relative;
  overflow:hidden;
}
.hudPanel::after, .inkPanel::after{
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
  background:repeating-linear-gradient(0deg, rgba(255,255,255,.03) 0 1px, transparent 1px 6px);
  opacity:.35;
  mix-blend-mode:overlay;
}
.stamp{
  position:absolute;
  right:10px;
  top:10px;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(200,60,60,.28);
  background:rgba(0,0,0,.34);
  font-family:Cinzel, serif;
  font-size:9px;
  letter-spacing:4px;
  color:rgba(245,238,220,.82);
  transform:rotate(-3deg);
  opacity:.82;
}

/* ================= ENTER ================= */
#loadingScreen{
  position:fixed;
  inset:0;
  background:radial-gradient(circle at center,#090a0e,#000);
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  z-index:90;
  transition:opacity .6s ease;
  overflow:hidden;
}
.loading-text{
  letter-spacing:6px;
  margin-bottom:20px;
  font-size:11px;
  opacity:.82;
  text-align:center;
  animation:flicker 2.2s infinite;
  max-width:90vw;
  font-family:Cinzel, serif;
}
@keyframes flicker{0%,100%{opacity:.78}50%{opacity:1}}
.spinner{
  width:40px;height:40px;
  border:3px solid rgba(255,255,255,.08);
  border-top:3px solid rgba(200,60,60,.55);
  border-radius:50%;
  animation:spin 1s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}
#enterBox{
  margin-top:34px;
  padding:18px 70px;
  border-radius:12px;
  background:rgba(10,8,7,0.62);
  border:1px solid rgba(200,60,60,0.28);
  backdrop-filter:blur(14px);
  letter-spacing:8px;
  font-weight:700;
  font-size:13px;
  color:rgba(245,238,220,.92);
  opacity:0;
  pointer-events:none;
  transition:.4s ease;
  cursor:pointer;
  user-select:none;
  font-family:Cinzel, serif;
  position:relative;
  overflow:hidden;
}
#enterBox::before{
  content:"";
  position:absolute;
  inset:-40% -30%;
  background:linear-gradient(90deg, transparent, rgba(245,238,220,.10), transparent);
  transform:rotate(14deg) translateX(-90%);
  opacity:0;
}
#enterBox.show{opacity:1; pointer-events:auto;}
#enterBox.show::before{
  opacity:.6;
  animation:scanPass 1.2s ease infinite;
}
@keyframes scanPass{
  0%{transform:rotate(14deg) translateX(-90%);}
  100%{transform:rotate(14deg) translateX(90%);}
}
#enterHint{
  margin-top:12px;
  font-size:9px;
  letter-spacing:4px;
  opacity:0;
  transition:.35s ease;
  color:rgba(245,238,220,.70);
  user-select:none;
  font-family:Cinzel, serif;
}
#enterHint.show{opacity:.88;}
#enterScan{
  position:absolute;
  inset:0;
  pointer-events:none;
  opacity:0;
  z-index:0;
}
#enterScan::before{
  content:"";
  position:absolute;
  left:-40%;
  top:0;
  width:45%;
  height:100%;
  background:linear-gradient(90deg, transparent, rgba(200,60,60,.10), rgba(245,238,220,.12), rgba(200,60,60,.10), transparent);
  transform:skewX(-14deg) translateX(-120%);
  filter: blur(1px);
}
#loadingScreen.scan-on #enterScan{ opacity:1; }
#loadingScreen.scan-on #enterScan::before{ animation: enterScanPass .85s ease 1; }
@keyframes enterScanPass{
  0%{transform:skewX(-14deg) translateX(-120%); opacity:0}
  15%{opacity:1}
  100%{transform:skewX(-14deg) translateX(380%); opacity:0}
}
#enterFooterLeft{
  position:fixed;
  left:18px;
  bottom:12px;
  z-index:91;
  font-size:9px;
  letter-spacing:3px;
  opacity:.30;
  user-select:none;
  font-family:Cinzel, serif;
}
body.entered #enterFooterLeft{ display:none; }

#versionTag{
  position:fixed;
  right:18px;
  bottom:12px;
  z-index:10;
  font-size:9px;
  letter-spacing:3px;
  opacity:.30;
  user-select:none;
  font-family:Cinzel, serif;
}
#versionTag .v{opacity:.88;color:rgba(245,238,220,.70);}

/* ================= HUD ENTER ONLY ================= */
#coordsHUD{
  position:fixed;
  top:16px;
  right:18px;
  z-index:12;
  padding:10px 12px;
  border-radius:14px;
  font-size:9px;
  letter-spacing:3px;
  opacity:.78;
  user-select:none;
  font-family:Cinzel, serif;
  border-left:2px solid rgba(200,60,60,.18);
}
#coordsHUD .line{opacity:.86}
#coordsHUD .blink{animation:coordsBlink 3.2s infinite}
@keyframes coordsBlink{0%,100%{opacity:.75}50%{opacity:.28}}

#techHUD{
  position:fixed;
  top:78px;
  left:18px;
  z-index:12;
  width:min(360px, 44vw);
  padding:10px 12px;
  border-radius:14px;
  font-size:9px;
  letter-spacing:3px;
  opacity:.70;
  user-select:none;
  line-height:1.65;
  font-family:Cinzel, serif;
  border-left:2px solid rgba(200,60,60,.16);
}
#techHUD .tag{opacity:.78}
#techHUD .value{opacity:.92; color:rgba(245,238,220,.86)}
#techHUD .sep{opacity:.22}

#statusStrip{
  position:fixed;
  left:18px;
  top:198px;
  width:min(240px, 34vw);
  z-index:12;
  opacity:.72;
  user-select:none;
  pointer-events:none;
  font-size:9px;
  letter-spacing:2px;
  line-height:1.45;
  font-family:Cinzel, serif;
}
#statusStrip .statusLine{
  display:flex;
  gap:8px;
  align-items:baseline;
  padding:7px 10px;
  border-radius:14px;
  margin-bottom:8px;
  background:linear-gradient(180deg, rgba(10,8,7,.62), rgba(0,0,0,.35));
  border:1px solid rgba(245,238,220,.08);
  border-left:2px solid rgba(200,60,60,.14);
  box-shadow: var(--shadowC);
}
#statusStrip .k{opacity:.70}
#statusStrip .v{opacity:.92; color:rgba(245,238,220,.82)}
#statusStrip .faint{opacity:.55}

body.entered #coordsHUD,
body.entered #techHUD,
body.entered #statusStrip{ display:none; }

@media (max-width: 768px){
  :root{ --blur-amount: 22px; }
  #techHUD, #statusStrip{display:none;}
}

/* ================= TOP CONTROLS (SÓ 3) ================= */
#topControls{
  position:fixed;
  top:14px;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  gap:10px;
  z-index:40;
  opacity:.95;
  transition:.18s ease;
}
#topControls:hover{opacity:1}
.ctrlBtn{
  width:46px;height:38px;
  border-radius:14px;
  border:1px solid rgba(245,238,220,.10);
  background:
    radial-gradient(circle at 30% 30%, rgba(245,238,220,.06), transparent 58%),
    linear-gradient(180deg, rgba(10,8,7,.66), rgba(0,0,0,.46));
  backdrop-filter: blur(14px);
  cursor:pointer;
  display:grid;
  place-items:center;
  box-shadow:
    0 0 0 1px rgba(0,0,0,.32) inset,
    0 18px 54px rgba(0,0,0,.50);
  position:relative;
  overflow:hidden;
  color:rgba(245,238,220,.92);
  user-select:none;
}
.ctrlBtn::after{
  content:"";
  position:absolute;
  inset:-40% -30%;
  background:linear-gradient(90deg, transparent, rgba(200,60,60,.10), transparent);
  transform:rotate(16deg) translateX(-90%);
  opacity:0;
  pointer-events:none;
}
#topControls:hover .ctrlBtn::after{
  opacity:1;
  animation:scanPass2 1.25s ease infinite;
}
@keyframes scanPass2{
  0%{transform:rotate(16deg) translateX(-90%);}
  100%{transform:rotate(16deg) translateX(90%);}
}
.ctrlBtn:hover{
  transform: translateY(-1px);
  box-shadow:
    0 0 0 1px rgba(0,0,0,.32) inset,
    0 22px 62px rgba(0,0,0,.60),
    0 0 24px rgba(200,60,60,.07);
}
.ctrlBtn:active{transform:translateY(1px)}
.ctrlBtn svg{
  width:20px;height:20px;
  opacity:.92;
  filter: url(#ink) drop-shadow(0 0 10px rgba(0,0,0,.35));
}

/* ================= SELOS BUTTON (UNICO LOCAL DE ROTAS) ================= */
#socialControl{
  position:fixed;
  top:12px;
  right:14px;
  z-index:41;
  opacity:.95;
  transition:.18s ease;
}
#socialControl:hover{opacity:1}
.linkPill{
  height:38px;
  padding:0 12px;
  border-radius:999px;
  border:1px solid rgba(245,238,220,.10);
  background:
    radial-gradient(circle at 30% 30%, rgba(245,238,220,.06), transparent 60%),
    linear-gradient(180deg, rgba(10,8,7,.62), rgba(0,0,0,.40));
  backdrop-filter: blur(14px);
  cursor:pointer;
  display:flex;
  align-items:center;
  gap:8px;
  color:rgba(245,238,220,.90);
  letter-spacing:4px;
  font-size:9px;
  box-shadow:
    0 0 0 1px rgba(255,255,255,.03) inset,
    0 16px 50px rgba(0,0,0,.46);
  position:relative;
  font-family:Cinzel, serif;
  user-select:none;
}
.linkPill svg{
  width:18px;height:18px;
  opacity:.92;
  filter: url(#ink) drop-shadow(0 0 10px rgba(0,0,0,.35));
}
.linkPill:hover{transform: translateY(-1px);}
.linkPill:active{transform:translateY(1px);}
@media (max-width: 520px){
  .linkPill span{display:none;}
  .linkPill{padding:0 10px;}
}

/* ================= ROUTES NODE (SELOS) ================= */
#routesNode{
  position:fixed;
  top:54px;
  right:14px;
  z-index:80;
  display:none;
  pointer-events:none;
}
#routesNode.show{display:block; pointer-events:auto;}
.routesBox{
  width:86px;
  padding:10px;
  border-radius:18px;
  border:1px solid rgba(245,238,220,.10);
  background:
    radial-gradient(circle at 35% 20%, rgba(245,238,220,.06), transparent 62%),
    linear-gradient(180deg, rgba(10,8,7,.70), rgba(0,0,0,.46));
  backdrop-filter: blur(14px);
  box-shadow: var(--shadowB);
  display:flex;
  flex-direction:column;
  gap:10px;
  position:relative;
}
.routeBtn{
  width:62px;
  height:62px;
  border-radius:18px;
  border:1px solid rgba(245,238,220,.10);
  background:
    radial-gradient(circle at 30% 30%, rgba(245,238,220,.05), transparent 64%),
    linear-gradient(180deg, rgba(0,0,0,.12), rgba(0,0,0,.34));
  box-shadow:
    0 0 0 1px rgba(0,0,0,.34) inset,
    0 14px 40px rgba(0,0,0,.38);
  display:grid;
  place-items:center;
  cursor:pointer;
  position:relative;
  opacity:0;
  transform:translateY(-10px) scale(.96);
  overflow:hidden;
}
#routesNode.show .routeBtn{ animation: sealPop .22s ease forwards; }
#routesNode.show .routeBtn:nth-child(2){animation-delay:.06s}
#routesNode.show .routeBtn:nth-child(3){animation-delay:.12s}
#routesNode.show .routeBtn:nth-child(4){animation-delay:.18s}
#routesNode.show .routeBtn:nth-child(5){animation-delay:.24s}
#routesNode.show .routeBtn:nth-child(6){animation-delay:.30s}
@keyframes sealPop{
  0%{opacity:0; transform:translateY(-10px) scale(.94); filter: blur(.6px);}
  70%{opacity:1; transform:translateY(1px) scale(1.02); filter:none;}
  100%{opacity:1; transform:translateY(0) scale(1.0);}
}
.routeBtn:hover{transform: translateY(-1px);}

/* ================= KEY HELP ================= */
#keyHelp{
  position:fixed;
  left:50%;
  bottom:14px;
  transform:translateX(-50%);
  z-index:20;
  padding:10px 12px;
  border-radius:999px;
  border:1px solid rgba(245,238,220,.10);
  background:rgba(0,0,0,.32);
  backdrop-filter: blur(14px);
  font-family:Cinzel, serif;
  font-size:9px;
  letter-spacing:4px;
  color:rgba(245,238,220,.78);
  opacity:0;
  transition:.25s ease;
  user-select:none;
  pointer-events:none;
}
body.entered #keyHelp{opacity:.82;}
@media (max-width: 768px){ #keyHelp{display:none;} }

/* ================= MODAL SYSTEM ================= */
.modal{
  position:fixed;
  inset:0;
  display:none;
  z-index:70;
  background:rgba(0,0,0,.62);
  backdrop-filter: blur(14px);
}
.modal.show{display:block;}
.modal .backdropClose{position:absolute; inset:0; cursor:pointer;}

.modalShell{
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
  width:min(980px, 92vw);
  height:min(640px, 84vh);
  border-radius:22px;
  border:1px solid rgba(245,238,220,.12);
  background:
    radial-gradient(circle at 18% 12%, rgba(245,238,220,.08), transparent 58%),
    linear-gradient(180deg, rgba(10,8,7,.72), rgba(0,0,0,.52));
  box-shadow: var(--shadowB);
  overflow:hidden;
  display:flex;
  flex-direction:column;
}
.modalHeader{
  position:relative;
  z-index:2;
  padding:14px 16px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  border-bottom:1px solid rgba(245,238,220,.08);
}
.modalTitle{
  display:flex;
  align-items:baseline;
  gap:10px;
  font-family:Cinzel, serif;
  letter-spacing:5px;
  color:rgba(245,238,220,.90);
}
.modalTitle small{
  letter-spacing:3px;
  opacity:.62;
  font-family:Inter, sans-serif;
}
.modalActions{display:flex;gap:10px;align-items:center;}
.pill{
  height:34px;
  padding:0 12px;
  border-radius:999px;
  border:1px solid rgba(245,238,220,.10);
  background:rgba(0,0,0,.30);
  color:rgba(245,238,220,.86);
  font-family:Cinzel, serif;
  font-size:9px;
  letter-spacing:4px;
  cursor:pointer;
  user-select:none;
}
.pill.danger{border-color:rgba(200,60,60,.22);}
.modalBody{
  position:relative;
  z-index:2;
  flex:1;
  display:flex;
  overflow:hidden;
}
.rail{
  width:260px;
  border-right:1px solid rgba(245,238,220,.08);
  padding:12px;
  overflow:auto;
}
.content{flex:1; padding:14px; overflow:auto;}

.railBtn{
  width:100%;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding:10px 12px;
  border-radius: var(--radius-md);
  border:1px solid rgba(245,238,220,.10);
  background:linear-gradient(180deg, rgba(10,8,7,.55), rgba(0,0,0,.30));
  color:rgba(245,238,220,.86);
  cursor:pointer;
  user-select:none;
  font-family:Cinzel, serif;
  letter-spacing:4px;
  font-size:9px;
  margin-bottom:8px;
}

/* ================= GRIMÓRIO (MODAL “terminal antigo” dentro dos selos) ================= */
.terminalWrap{
  border:1px solid rgba(245,238,220,.10);
  border-radius:22px;
  background:
    radial-gradient(circle at 22% 12%, rgba(245,238,220,.06), transparent 58%),
    linear-gradient(180deg, rgba(0,0,0,.18), rgba(0,0,0,.42));
  box-shadow: var(--shadowA);
  overflow:hidden;
  position:relative;
  min-height: 520px;
}
.terminalTop{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:12px 14px;
  border-bottom:1px solid rgba(245,238,220,.08);
}
.terminalTop .label{
  font-family:Cinzel, serif;
  letter-spacing:5px;
  font-size:11px;
  color:rgba(245,238,220,.90);
}
.terminalTop .sub{font-size:11px; opacity:.70; letter-spacing:2px;}
.termBody{
  padding:14px;
  height: 520px;
  overflow:auto;
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
  font-size:12px;
  line-height:1.55;
  color:rgba(245,238,220,.88);
}
.termLine{margin-bottom:8px; opacity:.92;}
.termLine .prompt{color:rgba(200,60,60,.42)}
.termLine .mut{opacity:.68}
.termLine .ok{color:rgba(245,238,220,.92)}
.termLine .warn{color:rgba(245,238,220,.80)}
.cursor{
  display:inline-block;
  width:10px;
  height:14px;
  background:rgba(245,238,220,.58);
  margin-left:6px;
  transform:translateY(2px);
  animation:blink 1.05s steps(2) infinite;
  border-radius:2px;
}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.15}}

/* ================= PERGAMINHO (BOTÃO DA TELA NORMAL) ================= */
/* modal com aparência de pergaminho + animação de abrir */
#modalParchment .modalShell{
  background: transparent;
  border:none;
  box-shadow:none;
  overflow:visible;
}
.parchmentShell{
  width:min(980px, 92vw);
  height:min(640px, 84vh);
  margin:auto;
  position:relative;
  transform-origin: top center;
  transform: translateY(6px) scale(.96);
  opacity:0;
  filter: blur(.4px);
}
#modalParchment.show .parchmentShell{
  animation: parchOpen .38s ease forwards;
}
@keyframes parchOpen{
  0%{opacity:0; transform: translateY(10px) scale(.93) rotateX(6deg);}
  70%{opacity:1; transform: translateY(-2px) scale(1.01) rotateX(0deg);}
  100%{opacity:1; transform: translateY(0px) scale(1.0) rotateX(0deg); filter:none;}
}

.parchment{
  position:absolute;
  inset:0;
  border-radius: 26px;
  border:1px solid rgba(245,238,220,.18);
  box-shadow: var(--shadowB);
  overflow:hidden;
  background:
    radial-gradient(circle at 18% 12%, rgba(245,238,220,.22), transparent 55%),
    radial-gradient(circle at 76% 84%, rgba(200,60,60,.12), transparent 60%),
    linear-gradient(180deg, rgba(30,24,18,.84), rgba(12,10,9,.78));
}
.parchment::before{
  content:"";
  position:absolute;
  inset:-20%;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='260' height='260'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.55' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='.55'/%3E%3C/svg%3E");
  opacity:.20;
  mix-blend-mode:overlay;
  pointer-events:none;
}
.parchment::after{
  content:"";
  position:absolute;
  inset:0;
  background:
    radial-gradient(circle at 50% 50%, transparent 0 58%, rgba(0,0,0,.48) 84%, rgba(0,0,0,.75) 100%),
    repeating-linear-gradient(0deg, rgba(255,255,255,.04) 0 1px, transparent 1px 7px);
  opacity:.30;
  mix-blend-mode:overlay;
  pointer-events:none;
}

.parchHeader{
  position:relative;
  z-index:2;
  padding:16px 18px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  border-bottom:1px solid rgba(245,238,220,.12);
}
.parchTitle{
  font-family:Cinzel, serif;
  letter-spacing:6px;
  font-size:12px;
  color:rgba(245,238,220,.92);
}
.parchTitle small{
  margin-left:10px;
  letter-spacing:3px;
  opacity:.62;
  font-family:Inter, sans-serif;
}
.parchActions{display:flex; gap:10px; align-items:center;}

.parchBody{
  position:relative;
  z-index:2;
  padding:16px 18px;
  height: calc(100% - 58px);
  overflow:auto;
  color:rgba(245,238,220,.90);
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
  font-size:12.5px;
  line-height:1.65;
  text-shadow:0 0 12px rgba(0,0,0,.55);
}
.parchLine{margin-bottom:10px; opacity:.94;}
.parchPrompt{color:rgba(200,60,60,.45)}
.parchSoft{opacity:.72}
.parchOk{color:rgba(245,238,220,.94)}
.parchWarn{color:rgba(245,238,220,.80)}

/* “rolos” decorativos */
.roll{
  position:absolute;
  top:50%;
  width:26px;
  height: calc(100% - 34px);
  transform:translateY(-50%);
  border-radius: 18px;
  background:linear-gradient(180deg, rgba(245,238,220,.10), rgba(0,0,0,.25));
  border:1px solid rgba(245,238,220,.10);
  box-shadow: 0 14px 44px rgba(0,0,0,.55);
  opacity:.75;
}
.roll.left{left:-10px}
.roll.right{right:-10px}

@media (prefers-reduced-motion: reduce){
  #cinemaFX::before{animation:none}
  #modalParchment.show .parchmentShell{animation:none; opacity:1; transform:none;}
}
</style>
</head>
<body>

<!-- SVG defs: filtro INK pros ícones -->
<svg width="0" height="0" style="position:absolute">
  <defs>
    <filter id="ink">
      <feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="2" seed="2" result="noise"/>
      <feDisplacementMap in="SourceGraphic" in2="noise" scale="0.8" xChannelSelector="R" yChannelSelector="G"/>
    </filter>
  </defs>
</svg>

<!-- BACKGROUND VIDEO -->
<video id="videoBlur" playsinline preload="auto" muted loop>
  <source src="https://files.catbox.moe/klaol5.webm" type="video/webm" />
</video>
<video id="video" playsinline preload="auto" loop>
  <source src="https://files.catbox.moe/klaol5.webm" type="video/webm" />
</video>

<!-- AUDIO -->
<audio id="ambience" preload="auto" loop>
  <source src="https://files.catbox.moe/99fu05.m4a" type="audio/mp4">
</audio>

<div class="scanlines"></div>
<div id="cinemaFX"></div>
<div id="glitchFlash"></div>

<div id="versionTag"><span class="v">shadow temple interface: v4.1 (seals-only routes)</span></div>
<div id="keyHelp">ESC FECHA // P PERGAMINHO // A ADM // S SELOS</div>

<!-- ENTER -->
<div id="loadingScreen">
  <div id="enterScan" aria-hidden="true"></div>
  <div class="loading-text" id="dynamicText">O TEMPLO OBSERVA…</div>
  <div class="spinner" id="spinner"></div>
  <div id="enterBox">ENTRAR</div>
  <div id="enterHint">PRESSIONE [ENTER] PARA PROSSEGUIR</div>
  <div id="enterFooterLeft">SELO ATIVO // PASSO PROIBIDO</div>
</div>

<!-- HUD ENTER -->
<div id="coordsHUD" class="hudPanel">
  <div class="line blink" id="coordA">SELO: — — —</div>
  <div class="line" id="coordB">PORTAL: LATENTE // VIGIA: PRESENTE</div>
</div>

<div id="techHUD" class="hudPanel">
  <div class="termLine"><span class="tag">RITO</span> <span class="sep">//</span> <span class="value" id="sysClock">--:--:--</span></div>
  <div class="termLine"><span class="tag">PORTAL</span> <span class="sep">//</span> <span class="value" id="sysStream">DORMENTE</span></div>
  <div class="termLine"><span class="tag">ECO</span> <span class="sep">//</span> <span class="value" id="sysNeural">SILÊNCIO</span></div>
  <div class="termLine"><span class="tag">VISITANTE</span> <span class="sep">//</span> <span class="value" id="sysSubject">À PORTA</span></div>
  <div class="termLine"><span class="tag">FASE</span> <span class="sep">//</span> <span class="value" id="sysPhase">DESPERTAR</span></div>
  <div class="termLine"><span class="tag">JURAMENTO</span> <span class="sep">//</span> <span class="value" id="sysDirective">OBSERVAR</span></div>
</div>

<div id="statusStrip">
  <div class="statusLine" id="ss1"><span class="k">TEMPLO</span> <span class="v">IMÓVEL</span></div>
  <div class="statusLine faint" id="ss2"><span class="k">PORTAL</span> <span class="v">LATENTE</span></div>
  <div class="statusLine faint" id="ss3"><span class="k">ECO</span> <span class="v">—</span></div>
</div>

<!-- TOP CONTROLS (SÓ 3) -->
<div id="topControls">
  <!-- Fullscreen -->
  <button class="ctrlBtn" id="btnFS" title="Ritual: Tela Cheia" aria-label="Tela cheia">
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <path d="M7 3H5a2 2 0 0 0-2 2v2M17 3h2a2 2 0 0 1 2 2v2M7 21H5a2 2 0 0 1-2-2v-2M17 21h2a2 2 0 0 0 2-2v-2"
        fill="none" stroke="rgba(245,238,220,.90)" stroke-width="2.2" stroke-linecap="round"/>
      <path d="M9 7h6M9 17h6" fill="none" stroke="rgba(200,60,60,.35)" stroke-width="1.6" stroke-linecap="round"/>
    </svg>
  </button>

  <!-- Pergaminho (NOVO) -->
  <button class="ctrlBtn" id="btnParch" title="Pergaminho (console ritual)" aria-label="Pergaminho">
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <path d="M7 5h10a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2V5Z"
        fill="none" stroke="rgba(245,238,220,.88)" stroke-width="2.0" stroke-linejoin="round"/>
      <path d="M9 8h8M9 11h8M9 14h6" fill="none" stroke="rgba(200,60,60,.24)" stroke-width="1.8" stroke-linecap="round"/>
      <path d="M7 5c0 0 0 0 0 0" fill="none"/>
    </svg>
  </button>

  <!-- ADM -->
  <button class="ctrlBtn" id="btnAdmin" title="Painel ADM" aria-label="Painel ADM">
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <path d="M12 3c5 0 8.5 2.9 8.5 7.9 0 7.3-5.6 10.9-8.5 10.9S3.5 18.2 3.5 10.9C3.5 5.9 7 3 12 3Z"
        fill="none" stroke="rgba(245,238,220,.88)" stroke-width="2.0" stroke-linejoin="round"/>
      <path d="M8.6 11c1.0-1.3 2.5-1.0 3.6 0m2.6 0c1.0-1.3 2.5-1.0 3.6 0"
        fill="none" stroke="rgba(245,238,220,.62)" stroke-width="2.0" stroke-linecap="round"/>
      <path d="M9 15.2c1.1.9 2.1 1.0 3 1.0s1.9-.1 3-1.0"
        fill="none" stroke="rgba(200,60,60,.26)" stroke-width="1.9" stroke-linecap="round"/>
    </svg>
  </button>
</div>

<!-- SELOS (ÚNICO LUGAR DE ROTAS: discord/arquivo/canais/arena/grimório antigo) -->
<div id="socialControl" aria-label="Selos">
  <button class="linkPill" id="btnLinks" type="button" title="SELOS" aria-label="Abrir selos">
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <path d="M9 14.5 7.2 16.3a3.2 3.2 0 1 1-4.5-4.5L4.6 10a3.2 3.2 0 0 1 4.5 0"
        fill="none" stroke="rgba(245,238,220,.86)" stroke-width="2.1" stroke-linecap="round"/>
      <path d="M15 9.5 16.8 7.7a3.2 3.2 0 0 1 4.5 4.5L19.4 14a3.2 3.2 0 0 1-4.5 0"
        fill="none" stroke="rgba(245,238,220,.70)" stroke-width="2.1" stroke-linecap="round"/>
      <path d="M8.8 15.2 15.2 8.8"
        fill="none" stroke="rgba(200,60,60,.28)" stroke-width="2.0" stroke-linecap="round"/>
    </svg>
    <span>SELOS</span>
  </button>
</div>

<!-- ROUTES NODE -->
<div id="routesNode" aria-hidden="true">
  <div class="routesBox" role="navigation" aria-label="Selos / Rotas">

    <!-- SOCIAL (discord/insta) -->
    <button class="routeBtn" id="rSocial" type="button" aria-label="Social">
      <svg viewBox="0 0 24 24" aria-hidden="true" style="width:18px;height:18px;opacity:.92;filter:url(#ink)">
        <path d="M12 3.6 19.2 8v8L12 20.4 4.8 16V8L12 3.6Z" fill="none" stroke="rgba(245,238,220,.82)" stroke-width="2.0" stroke-linejoin="round"/>
        <path d="M12 7.2v9.6M8.7 10.5 12 12.2l3.3-1.7" fill="none" stroke="rgba(200,60,60,.24)" stroke-width="1.8" stroke-linecap="round"/>
      </svg>
    </button>

    <!-- ARENA -->
    <button class="routeBtn" id="rGames" type="button" aria-label="Arena">
      <svg viewBox="0 0 24 24" aria-hidden="true" style="width:18px;height:18px;opacity:.92;filter:url(#ink)">
        <path d="M4 20l6-2 10-10-4-4L6 14l-2 6Z" fill="none" stroke="rgba(245,238,220,.82)" stroke-width="2.0" stroke-linejoin="round"/>
        <path d="M13.6 6.4l4 4" fill="none" stroke="rgba(200,60,60,.24)" stroke-width="1.8" stroke-linecap="round"/>
      </svg>
    </button>

    <!-- ARQUIVO -->
    <button class="routeBtn" id="rArchive" type="button" aria-label="Arquivo">
      <svg viewBox="0 0 24 24" aria-hidden="true" style="width:18px;height:18px;opacity:.92;filter:url(#ink)">
        <path d="M6 7h12v4H6V7Z" fill="none" stroke="rgba(245,238,220,.82)" stroke-width="2.0" stroke-linejoin="round"/>
        <path d="M7 11v9h10v-9" fill="none" stroke="rgba(245,238,220,.62)" stroke-width="2.0" stroke-linejoin="round"/>
        <path d="M10 15h4" fill="none" stroke="rgba(200,60,60,.22)" stroke-width="1.8" stroke-linecap="round"/>
      </svg>
    </button>

    <!-- CANAIS -->
    <button class="routeBtn" id="rChannels" type="button" aria-label="Canais">
      <svg viewBox="0 0 24 24" aria-hidden="true" style="width:18px;height:18px;opacity:.92;filter:url(#ink)">
        <path d="M4 7h16M4 12h10M4 17h16" fill="none" stroke="rgba(245,238,220,.86)" stroke-width="2.2" stroke-linecap="round"/>
        <path d="M17 11l3 1-3 1" fill="none" stroke="rgba(200,60,60,.28)" stroke-width="2.0" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>

    <!-- GRIMÓRIO ANTIGO (terminal modal tradicional) -->
    <button class="routeBtn" id="rGrimoire" type="button" aria-label="Grimório">
      <svg viewBox="0 0 24 24" aria-hidden="true" style="width:18px;height:18px;opacity:.92;filter:url(#ink)">
        <path d="M12 3.8c4.8 0 8.4 3.2 8.4 8.2S16.8 20.2 12 20.2 3.6 17 3.6 12 7.2 3.8 12 3.8Z"
          fill="none" stroke="rgba(245,238,220,.86)" stroke-width="2.0" stroke-linejoin="round"/>
        <path d="M12 7.2v9.6M7.2 12h9.6" fill="none" stroke="rgba(200,60,60,.30)" stroke-width="1.8" stroke-linecap="round"/>
      </svg>
    </button>

  </div>
</div>

<!-- ================= MODAIS ================= -->

<!-- PERGAMINHO (NOVO - tela normal) -->
<div class="modal" id="modalParchment" aria-hidden="true">
  <div class="backdropClose" data-close="modalParchment"></div>
  <div class="parchmentShell">
    <div class="parchment">
      <div class="roll left" aria-hidden="true"></div>
      <div class="roll right" aria-hidden="true"></div>

      <div class="parchHeader">
        <div class="parchTitle">PERGAMINHO <small>// escrito em tinta</small></div>
        <div class="parchActions">
          <button class="pill" id="parchRun">INICIAR</button>
          <button class="pill danger" data-close="modalParchment">FECHAR</button>
        </div>
      </div>

      <div class="parchBody" id="parchBody"></div>
    </div>
  </div>
</div>

<!-- GRIMÓRIO (antigo) - fica só nos SELOS -->
<div class="modal" id="modalTerminal" aria-hidden="true">
  <div class="backdropClose" data-close="modalTerminal"></div>
  <div class="modalShell">
    <div class="modalHeader">
      <div class="modalTitle">GRIMÓRIO <small>// console ritual</small></div>
      <div class="modalActions">
        <button class="pill" id="termRun">INICIAR RITO</button>
        <button class="pill danger" data-close="modalTerminal">FECHAR</button>
      </div>
    </div>
    <div class="modalBody">
      <div class="rail">
        <button class="railBtn" data-cmd="status"><span>STATUS</span><span>•</span></button>
        <button class="railBtn" data-cmd="seal"><span>QUEBRAR SELO</span><span>•</span></button>
        <button class="railBtn" data-cmd="summon"><span>INVOKE</span><span>•</span></button>
        <button class="railBtn" data-cmd="clear"><span>LIMPAR</span><span>•</span></button>
      </div>
      <div class="content">
        <div class="terminalWrap">
          <div class="terminalTop">
            <div>
              <div class="label">SHELL // INK</div>
              <div class="sub" id="termSub">conectando ao véu…</div>
            </div>
          </div>
          <div class="termBody" id="termBody"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ARENA -->
<div class="modal" id="modalArena" aria-hidden="true">
  <div class="backdropClose" data-close="modalArena"></div>
  <div class="modalShell">
    <div class="modalHeader">
      <div class="modalTitle">ARENA <small>// game OS</small></div>
      <div class="modalActions">
        <button class="pill" id="arenaShuffle">MUDAR ORÁCULO</button>
        <button class="pill danger" data-close="modalArena">FECHAR</button>
      </div>
    </div>
    <div class="modalBody">
      <div class="content" id="arenaContent" style="width:100%;">
        <!-- (conteúdo da arena será injetado no JS, igual antes) -->
        <div id="arenaMount"></div>
      </div>
    </div>
  </div>
</div>

<!-- ARQUIVO -->
<div class="modal" id="modalArchive" aria-hidden="true">
  <div class="backdropClose" data-close="modalArchive"></div>
  <div class="modalShell">
    <div class="modalHeader">
      <div class="modalTitle">ARQUIVO <small>// memórias</small></div>
      <div class="modalActions">
        <input id="archiveSearch" placeholder="buscar..." style="height:34px;border-radius:999px;border:1px solid rgba(245,238,220,.12);background:rgba(0,0,0,.28);color:rgba(245,238,220,.88);padding:0 12px;outline:none;">
        <button class="pill danger" data-close="modalArchive">FECHAR</button>
      </div>
    </div>
    <div class="modalBody">
      <div class="content">
        <div id="archiveGrid" style="display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px;"></div>
      </div>
    </div>
  </div>
</div>

<!-- CANAIS (Discord/Insta etc) -->
<div class="modal" id="modalChannels" aria-hidden="true">
  <div class="backdropClose" data-close="modalChannels"></div>
  <div class="modalShell">
    <div class="modalHeader">
      <div class="modalTitle">CANAIS <small>// social & rotas</small></div>
      <div class="modalActions">
        <button class="pill" id="channelsPing">PULSAR</button>
        <button class="pill danger" data-close="modalChannels">FECHAR</button>
      </div>
    </div>
    <div class="modalBody">
      <div class="content">
        <div style="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px;">
          <div class="inkPanel" style="border-radius:22px;padding:14px;position:relative;">
            <div class="stamp">SOCIAL</div>
            <div style="font-family:Cinzel,serif;letter-spacing:6px;color:rgba(245,238,220,.92);">DISCORD</div>
            <div style="margin-top:8px;opacity:.72;">call, stream, bio, link.</div>
            <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap;">
              <button class="pill" id="openDiscord">ABRIR</button>
              <button class="pill" id="copyBio">COPIAR BIO</button>
              <button class="pill danger" id="copyLink">COPIAR LINK</button>
            </div>
          </div>
          <div class="inkPanel" style="border-radius:22px;padding:14px;position:relative;">
            <div class="stamp">SELO</div>
            <div style="font-family:Cinzel,serif;letter-spacing:6px;color:rgba(245,238,220,.92);">INSTAGRAM</div>
            <div style="margin-top:8px;opacity:.72;">marca pública / vitrine.</div>
            <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap;">
              <button class="pill" id="openInsta">ABRIR</button>
              <button class="pill danger" id="copyInsta">COPIAR</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ADMIN (permanece na tela normal pelo botão ADM) -->
<div class="modal" id="modalAdmin" aria-hidden="true">
  <div class="backdropClose" data-close="modalAdmin"></div>
  <div class="modalShell">
    <div class="modalHeader">
      <div class="modalTitle">PAINEL ADM <small>// ajustes</small></div>
      <div class="modalActions">
        <button class="pill" id="triggerGlitch">QUEBRAR SELO</button>
        <button class="pill danger" data-close="modalAdmin">FECHAR</button>
      </div>
    </div>
    <div class="modalBody">
      <div class="content">
        <div style="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px;">
          <div class="inkPanel" style="border-radius:22px;padding:14px;position:relative;">
            <div class="stamp">VÉU</div>
            <div style="font-family:Cinzel,serif;letter-spacing:6px;color:rgba(245,238,220,.92);">BLUR</div>
            <div style="margin-top:10px;">
              <input type="range" id="blurRange" min="10" max="46" step="1" value="26" style="width:100%;">
              <div style="margin-top:8px;opacity:.72;" id="blurRead">BLUR: 26</div>
            </div>
          </div>

          <div class="inkPanel" style="border-radius:22px;padding:14px;position:relative;">
            <div class="stamp">OVERLAYS</div>
            <div style="font-family:Cinzel,serif;letter-spacing:6px;color:rgba(245,238,220,.92);">GRAIN / SCAN</div>
            <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap;">
              <button class="pill" id="toggleGrain">TOGGLE GRAIN</button>
              <button class="pill" id="toggleScan">TOGGLE SCAN</button>
              <button class="pill danger" id="hardReset">RESET</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
const video = document.getElementById("video");
const videoBlur = document.getElementById("videoBlur");
const ambience = document.getElementById("ambience");

const enterBox = document.getElementById("enterBox");
const enterHint = document.getElementById("enterHint");
const loadingScreen = document.getElementById("loadingScreen");
const dynamicText = document.getElementById("dynamicText");
const spinner = document.getElementById("spinner");

const coordA = document.getElementById("coordA");
const coordB = document.getElementById("coordB");

const sysClock = document.getElementById("sysClock");
const sysStream = document.getElementById("sysStream");
const sysNeural = document.getElementById("sysNeural");
const sysSubject = document.getElementById("sysSubject");
const sysPhase = document.getElementById("sysPhase");
const sysDirective = document.getElementById("sysDirective");

const btnFS = document.getElementById("btnFS");
const btnParch = document.getElementById("btnParch");
const btnAdmin = document.getElementById("btnAdmin");
const btnLinks = document.getElementById("btnLinks");

const routesNode = document.getElementById("routesNode");
const rSocial = document.getElementById("rSocial");
const rGames = document.getElementById("rGames");
const rArchive = document.getElementById("rArchive");
const rChannels = document.getElementById("rChannels");
const rGrimoire = document.getElementById("rGrimoire");

/* MODAIS */
const modalParchment = document.getElementById("modalParchment");
const modalAdmin = document.getElementById("modalAdmin");
const modalTerminal = document.getElementById("modalTerminal");
const modalArena = document.getElementById("modalArena");
const modalArchive = document.getElementById("modalArchive");
const modalChannels = document.getElementById("modalChannels");

/* Pergaminho */
const parchBody = document.getElementById("parchBody");
const parchRun = document.getElementById("parchRun");

/* Grimório antigo */
const termBody = document.getElementById("termBody");
const termSub = document.getElementById("termSub");
const termRun = document.getElementById("termRun");

/* Archive */
const archiveGrid = document.getElementById("archiveGrid");
const archiveSearch = document.getElementById("archiveSearch");

/* Channels */
const openDiscord = document.getElementById("openDiscord");
const copyBio = document.getElementById("copyBio");
const copyLink = document.getElementById("copyLink");
const openInsta = document.getElementById("openInsta");
const copyInsta = document.getElementById("copyInsta");
const channelsPing = document.getElementById("channelsPing");

/* Admin */
const toggleGrain = document.getElementById("toggleGrain");
const toggleScan = document.getElementById("toggleScan");
const triggerGlitchBtn = document.getElementById("triggerGlitch");
const blurRange = document.getElementById("blurRange");
const blurRead = document.getElementById("blurRead");
const hardReset = document.getElementById("hardReset");

let hasEntered = false;
let readyToEnter = false;
let sealsOpen = false;

let grainOn = true;
let scanOn = true;

function pad2(n){ return String(n).padStart(2,"0"); }

function triggerGlitch(){
  document.body.classList.remove("glitch-on");
  void document.body.offsetWidth;
  document.body.classList.add("glitch-on");
  setTimeout(()=>document.body.classList.remove("glitch-on"), 700);
}

function hardStopMediaIfNotEntered(){
  if (hasEntered) return;
  try{ video.pause(); video.currentTime = 0; }catch(e){}
  try{ videoBlur.pause(); videoBlur.currentTime = 0; }catch(e){}
  try{ ambience.pause(); ambience.currentTime = 0; }catch(e){}
}

/* ================= ENTER FLOW ================= */
const messages = [
  "O TEMPLO OBSERVA…",
  "SELOS SE FECHAM…",
  "O PORTAL RESPIRA…",
  "SOMBRA EM SILÊNCIO…",
  "PRESENÇA DETECTADA…",
  "UM PASSO E NÃO VOLTA…"
];
let msgIndex = 0;
setInterval(() => {
  msgIndex = (msgIndex + 1) % messages.length;
  dynamicText.textContent = messages[msgIndex];
}, 2200);

function showEnter(){
  enterBox.classList.add("show");
  enterHint.classList.add("show");
  loadingScreen.classList.add("scan-on");
  setTimeout(()=>loadingScreen.classList.remove("scan-on"), 1200);
}
function markReady(){
  if (readyToEnter) return;
  readyToEnter = true;
  showEnter();
}

setTimeout(() => {
  if (!readyToEnter) {
    dynamicText.textContent = "SINAL FRACO // ENTRADA MANUAL LIBERADA";
    markReady();
  }
}, 9000);

video.addEventListener("loadeddata", markReady, { once:true });
video.addEventListener("canplay", markReady, { once:true });

function doEnter(){
  if (!readyToEnter || hasEntered) return;
  hasEntered = true;

  loadingScreen.style.opacity = "0";
  setTimeout(()=>{ loadingScreen.style.display = "none"; }, 650);

  document.body.classList.add("entered");

  video.currentTime = 0;
  videoBlur.currentTime = 0;
  video.play().catch(()=>{});
  videoBlur.play().catch(()=>{});
  ambience.currentTime = 0;
  ambience.play().catch(()=>{});

  triggerGlitch();
}
enterBox.addEventListener("click", doEnter);
document.addEventListener("keydown", (e) => {
  if (e.key === "Enter" && !hasEntered) doEnter();
});

document.addEventListener("DOMContentLoaded", hardStopMediaIfNotEntered);
window.addEventListener("pageshow", () => hardStopMediaIfNotEntered());

/* ================= HUD DYNAMIC ================= */
function tickTech(){
  const d = new Date();
  sysClock.textContent = `${pad2(d.getHours())}:${pad2(d.getMinutes())}:${pad2(d.getSeconds())}`;
  const r = Math.random();
  sysStream.textContent = video.readyState >= 3 ? "VIVO" : (video.readyState ? "LATENTE" : "DORMENTE");
  sysNeural.textContent = r > 0.92 ? "SUSSURROS" : (r > 0.75 ? "ECO" : "SILÊNCIO");
  sysSubject.textContent = hasEntered ? "NO TEMPLO" : "À PORTA";
}
setInterval(tickTech, 900);
tickTech();

function rndSeal(){
  const rune = ["Σ","Δ","Ψ","Λ","Ω","ϟ","⟡","⟁","⧫","⟟"][Math.floor(Math.random()*10)];
  const n = Math.floor(1+Math.random()*99).toString().padStart(2,"0");
  coordA.textContent = `SELO: ${rune}-${n} // CORROMP: ${Math.random()>.18?"BAIXA":"ALTA"}`;
  coordB.textContent = `PORTAL: ${Math.random()>.25?"LATENTE":"ABERTO"} // VIGIA: ${Math.random()>.15?"PRESENTE":"ATENTO"}`;
}
setInterval(rndSeal, 2200);
rndSeal();

/* ================= FULLSCREEN ================= */
async function toggleFullscreen(){
  try{
    if (!document.fullscreenElement) await document.documentElement.requestFullscreen();
    else await document.exitFullscreen();
  } catch(e){}
}
btnFS.addEventListener("click", toggleFullscreen);

/* ================= MODAL ENGINE ================= */
const allModals = [modalParchment, modalAdmin, modalTerminal, modalArena, modalArchive, modalChannels];
function closeAllModals(){ allModals.forEach(m => m.classList.remove("show")); }
function openModal(modal){
  closeAllModals();
  modal.classList.add("show");
  triggerGlitch();
}
function toggleModal(modal){
  if (modal.classList.contains("show")) modal.classList.remove("show");
  else openModal(modal);
}

/* close by dataset */
document.addEventListener("click", (e) => {
  const t = e.target;
  if (t && t.dataset && t.dataset.close){
    const el = document.getElementById(t.dataset.close);
    if (el) el.classList.remove("show");
  }
  if (t && t.classList && t.classList.contains("backdropClose")){
    const el = document.getElementById(t.dataset.close);
    if (el) el.classList.remove("show");
  }
});

/* ESC fecha tudo */
document.addEventListener("keydown", (e) => {
  if (e.key === "Escape"){
    closeAllModals();
    closeSeals();
  }
});

/* ================= SELOS NODE ================= */
function openSeals(){
  sealsOpen = true;
  routesNode.classList.add("show");
  triggerGlitch();
}
function closeSeals(){
  sealsOpen = false;
  routesNode.classList.remove("show");
}
function toggleSeals(){ sealsOpen ? closeSeals() : openSeals(); }

btnLinks.addEventListener("click", (e) => { e.stopPropagation(); toggleSeals(); });
document.addEventListener("click", (e) => {
  const within = routesNode.contains(e.target) || btnLinks.contains(e.target);
  if (!within) closeSeals();
});

/* Rotas dentro dos SELOS */
rSocial.addEventListener("click", (e)=>{ e.stopPropagation(); openModal(modalChannels); closeSeals(); });
rGames.addEventListener("click", (e)=>{ e.stopPropagation(); openModal(modalArena); closeSeals(); });
rArchive.addEventListener("click", (e)=>{ e.stopPropagation(); openModal(modalArchive); closeSeals(); });
rChannels.addEventListener("click", (e)=>{ e.stopPropagation(); openModal(modalChannels); closeSeals(); });
rGrimoire.addEventListener("click", (e)=>{ e.stopPropagation(); openModal(modalTerminal); closeSeals(); });

/* ================= BOTÕES DA TELA NORMAL ================= */
btnParch.addEventListener("click", ()=>toggleModal(modalParchment));
btnAdmin.addEventListener("click", ()=>toggleModal(modalAdmin));

/* atalhos */
document.addEventListener("keydown", (e) => {
  if (!hasEntered) return;
  if (["INPUT","TEXTAREA"].includes(document.activeElement?.tagName)) return;

  if (e.key.toLowerCase() === "p") toggleModal(modalParchment);
  if (e.key.toLowerCase() === "a") toggleModal(modalAdmin);
  if (e.key.toLowerCase() === "s") toggleSeals();
});

/* ================= PERGAMINHO (console próprio) ================= */
let parchSeeded = false;
let parchBusy = false;

function parchPrint(html, cls=""){
  const div = document.createElement("div");
  div.className = "parchLine " + cls;
  div.innerHTML = html;
  parchBody.appendChild(div);
  parchBody.scrollTop = parchBody.scrollHeight;
}

function parchClear(){
  parchBody.innerHTML = "";
}

function seedParchment(){
  if (parchSeeded) return;
  parchSeeded = true;
  parchPrint(`<span class="parchPrompt">[tinta]</span> <span class="parchSoft">pergaminho aberto…</span>`);
  parchPrint(`<span class="parchPrompt">[tinta]</span> <span class="parchSoft">aguardando juramento…</span>`);
}

async function typeParch(text, cls=""){
  return new Promise((resolve)=>{
    const div = document.createElement("div");
    div.className = "parchLine " + cls;
    const span = document.createElement("span");
    div.appendChild(span);
    parchBody.appendChild(div);

    let i = 0;
    const speed = 10 + Math.floor(Math.random()*18);
    const timer = setInterval(()=>{
      i++;
      span.textContent = text.slice(0,i);
      parchBody.scrollTop = parchBody.scrollHeight;
      if (i >= text.length){
        clearInterval(timer);
        resolve();
      }
    }, speed);
  });
}

async function parchRitual(){
  if (parchBusy) return;
  parchBusy = true;

  parchPrint(`<span class="parchPrompt">[rito]</span> <span class="parchSoft">iniciando…</span>`);
  await typeParch("Rasgando o silêncio…");
  await typeParch("Molhando a pena…");
  await typeParch("Carimbando intenção…");

  const ok = Math.random() > 0.16;
  await typeParch(ok ? "Voto aceito. A tinta obedece." : "Voto instável. Reescreva com calma.", ok ? "parchOk":"parchWarn");
  parchPrint(`<span class="parchPrompt">[estado]</span> <span class="parchSoft">portal:</span> <span class="parchOk">${sysStream.textContent}</span> <span class="parchSoft">eco:</span> <span class="parchOk">${sysNeural.textContent}</span>`);
  parchPrint(`<span class="parchPrompt">[visitante]</span> <span class="parchOk">${sysSubject.textContent}</span>`);

  triggerGlitch();
  parchBusy = false;
}

parchRun.addEventListener("click", parchRitual);

/* quando abrir o modal do pergaminho, semear */
const parchObs = new MutationObserver(()=>{
  if (modalParchment.classList.contains("show")) seedParchment();
});
parchObs.observe(modalParchment, {attributes:true, attributeFilter:["class"]});

/* ================= GRIMÓRIO ANTIGO (terminal modal) ================= */
let termBusy = false;

function termPrint(line, cls=""){
  const div = document.createElement("div");
  div.className = "termLine " + cls;
  div.innerHTML = line;
  termBody.appendChild(div);
  termBody.scrollTop = termBody.scrollHeight;
}

function termCursor(on=true){
  const cur = document.createElement("span");
  cur.className = "cursor";
  if (on) termBody.appendChild(cur);
  termBody.scrollTop = termBody.scrollHeight;
  return cur;
}

async function typeLine(text, cls=""){
  return new Promise((resolve)=>{
    const div = document.createElement("div");
    div.className = "termLine " + cls;
    const span = document.createElement("span");
    div.appendChild(span);
    termBody.appendChild(div);

    let i = 0;
    const speed = 10 + Math.floor(Math.random()*18);
    const timer = setInterval(()=>{
      i++;
      span.textContent = text.slice(0,i);
      termBody.scrollTop = termBody.scrollHeight;
      if (i >= text.length){
        clearInterval(timer);
        resolve();
      }
    }, speed);
  });
}

function termClear(){ termBody.innerHTML = ""; }

async function termRitual(){
  if (termBusy) return;
  termBusy = true;
  termSub.textContent = "o véu responde…";

  termPrint(`<span class="prompt">[templo]</span> <span class="mut">invocando logs…</span>`);
  await typeLine("Ligando runas…");
  await typeLine("Afiando o silêncio…");
  await typeLine("Abrindo pergaminho de execução…");

  const r = Math.random();
  await typeLine(r > 0.18 ? "Voto aceito. Entrada concedida." : "Voto instável. Ajuste sua intenção.", r > 0.18 ? "ok":"warn");

  termPrint(`<span class="prompt">[cmd]</span> <span class="ok">status</span>`);
  termPrint(`<span class="mut">portal:</span> <span class="ok">${sysStream.textContent}</span>  <span class="mut">eco:</span> <span class="ok">${sysNeural.textContent}</span>`);
  termPrint(`<span class="mut">visitante:</span> <span class="ok">${sysSubject.textContent}</span>`);

  const cur = termCursor(true);
  setTimeout(()=>{ try{cur.remove();}catch(e){} }, 1600);

  termSub.textContent = "conectado.";
  triggerGlitch();
  termBusy = false;
}

termRun.addEventListener("click", termRitual);

function terminalSeed(){
  if (termBody.dataset.seeded) return;
  termBody.dataset.seeded = "1";
  termPrint(`<span class="prompt">[templo]</span> <span class="mut">arquivo de cinzas carregado</span>`);
  termPrint(`<span class="prompt">[templo]</span> <span class="mut">aguardando comando…</span>`);
  termCursor(true);
}
const termObs = new MutationObserver(()=>{
  if (modalTerminal.classList.contains("show")) terminalSeed();
});
termObs.observe(modalTerminal, {attributes:true, attributeFilter:["class"]});

document.querySelectorAll("#modalTerminal .railBtn").forEach(btn=>{
  btn.addEventListener("click", async ()=>{
    const cmd = btn.dataset.cmd;
    if (!cmd) return;

    if (cmd === "clear"){ termClear(); termPrint(`<span class="prompt">[cmd]</span> limpar`); return; }
    if (cmd === "status"){
      termPrint(`<span class="prompt">[cmd]</span> status`);
      termPrint(`<span class="mut">portal:</span> <span class="ok">${sysStream.textContent}</span>  <span class="mut">eco:</span> <span class="ok">${sysNeural.textContent}</span>`);
      return;
    }
    if (cmd === "seal"){
      termPrint(`<span class="prompt">[cmd]</span> quebrar_selo`);
      triggerGlitch();
      await typeLine("… rachadura detectada.");
      await typeLine("… tinta escorrendo.", "warn");
      return;
    }
    if (cmd === "summon"){
      termPrint(`<span class="prompt">[cmd]</span> invoke`);
      await typeLine("Chamando a entidade: DOITTORE…");
      await typeLine("Resultado: presença parcial. Risos no escuro.", "ok");
    }
  });
});

/* ================= ARENA (simples mount) ================= */
const arenaMount = document.getElementById("arenaMount");
const arenaShuffle = document.getElementById("arenaShuffle");

const gamePool = [
  { game:"VALORANT", goal:"AIM + CONSISTÊNCIA", prog:"14% // “subindo o véu”", note:"“controle antes do caos”" },
  { game:"CYBERPUNK 2077", goal:"IMERSÃO + HISTÓRIA", prog:"33% // “cidade sangra”", note:"“aperta o gatilho e some”" },
  { game:"ELDEN RING", goal:"BOSS + DISCIPLINA", prog:"48% // “voto quebrado”", note:"“um golpe por vez”" },
];
let currentArena = 0;

function renderArena(){
  const a = gamePool[currentArena];
  arenaMount.innerHTML = `
    <div class="inkPanel" style="border-radius:22px;padding:14px;position:relative;">
      <div class="stamp">ATIVO</div>
      <div style="font-family:Cinzel,serif;letter-spacing:6px;color:rgba(245,238,220,.92);font-size:14px;">JOGANDO AGORA</div>
      <div style="margin-top:10px;display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;">
        <div class="inkPanel" style="border-radius:18px;padding:12px;background:rgba(0,0,0,.20);box-shadow:0 0 0 1px rgba(0,0,0,.35) inset;">
          <div style="font-family:Cinzel,serif;letter-spacing:5px;font-size:9px;opacity:.74;">JOGO</div>
          <div style="margin-top:6px;letter-spacing:2px;opacity:.9;">${a.game}</div>
        </div>
        <div class="inkPanel" style="border-radius:18px;padding:12px;background:rgba(0,0,0,.20);box-shadow:0 0 0 1px rgba(0,0,0,.35) inset;">
          <div style="font-family:Cinzel,serif;letter-spacing:5px;font-size:9px;opacity:.74;">META</div>
          <div style="margin-top:6px;letter-spacing:2px;opacity:.9;">${a.goal}</div>
        </div>
        <div class="inkPanel" style="border-radius:18px;padding:12px;background:rgba(0,0,0,.20);box-shadow:0 0 0 1px rgba(0,0,0,.35) inset;">
          <div style="font-family:Cinzel,serif;letter-spacing:5px;font-size:9px;opacity:.74;">PROGRESSO</div>
          <div style="margin-top:6px;letter-spacing:2px;opacity:.9;">${a.prog}</div>
        </div>
        <div class="inkPanel" style="border-radius:18px;padding:12px;background:rgba(0,0,0,.20);box-shadow:0 0 0 1px rgba(0,0,0,.35) inset;">
          <div style="font-family:Cinzel,serif;letter-spacing:5px;font-size:9px;opacity:.74;">NOTA</div>
          <div style="margin-top:6px;letter-spacing:2px;opacity:.9;">${a.note}</div>
        </div>
      </div>
      <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap;">
        <button class="pill">ABRIR PORTAL</button>
        <button class="pill">NOTAS</button>
        <button class="pill danger">BUILD</button>
      </div>
    </div>
  `;
}
renderArena();
arenaShuffle.addEventListener("click", ()=>{
  currentArena = (currentArena + 1) % gamePool.length;
  renderArena();
  triggerGlitch();
});

/* ================= ARCHIVE DATA ================= */
const archiveItems = [
  {cat:"prints", title:"PRINT // 01", desc:"carimbo de batalha."},
  {cat:"builds", title:"BUILD // 01", desc:"setup do corte."},
  {cat:"notes", title:"NOTA // 01", desc:"juramento escrito."},
  {cat:"mods", title:"MOD // 01", desc:"tinta no UI."},
];
let archiveCat = null;

function renderArchive(){
  const q = (archiveSearch.value || "").trim().toLowerCase();
  archiveGrid.innerHTML = "";
  archiveItems
    .filter(it => !archiveCat || it.cat === archiveCat)
    .filter(it => !q || (it.title.toLowerCase().includes(q) || it.desc.toLowerCase().includes(q)))
    .forEach((it)=>{
      const c = document.createElement("div");
      c.className = "inkPanel";
      c.style.borderRadius = "22px";
      c.style.padding = "14px";
      c.style.position = "relative";
      c.innerHTML = `
        <div class="stamp">${it.cat.toUpperCase()}</div>
        <div style="font-family:Cinzel,serif;letter-spacing:6px;color:rgba(245,238,220,.92);font-size:11px;">${it.title}</div>
        <div style="margin-top:8px;opacity:.72;">${it.desc}</div>
        <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap;">
          <button class="pill">ABRIR</button>
          <button class="pill">RENOMEAR</button>
          <button class="pill danger">APAGAR</button>
        </div>
      `;
      archiveGrid.appendChild(c);
    });
}
archiveSearch.addEventListener("input", renderArchive);
renderArchive();

/* ================= CHANNELS ACTIONS ================= */
const SOCIAL = {
  discordUrl: "https://discord.com/app",
  instaUrl: "https://instagram.com/"
};
function copyText(t){
  navigator.clipboard?.writeText(t).then(()=>triggerGlitch()).catch(()=>{});
}
openDiscord.addEventListener("click", ()=> window.open(SOCIAL.discordUrl, "_blank", "noopener,noreferrer"));
openInsta.addEventListener("click", ()=> window.open(SOCIAL.instaUrl, "_blank", "noopener,noreferrer"));
copyBio.addEventListener("click", ()=> copyText("Sistema ativo. Jogador online. // DOITTORE observa."));
copyLink.addEventListener("click", ()=> copyText(SOCIAL.discordUrl));
copyInsta.addEventListener("click", ()=> copyText(SOCIAL.instaUrl));
channelsPing.addEventListener("click", ()=>{ triggerGlitch(); rndSeal(); });

/* ================= ADMIN CONTROLS ================= */
function applyBlur(v){
  document.documentElement.style.setProperty("--blur-amount", v + "px");
  blurRead.textContent = "BLUR: " + v;
}
applyBlur(Number(blurRange.value));
blurRange.addEventListener("input", ()=> applyBlur(Number(blurRange.value)));

toggleGrain.addEventListener("click", ()=>{
  grainOn = !grainOn;
  document.getElementById("cinemaFX").style.display = grainOn ? "block" : "none";
  triggerGlitch();
});
toggleScan.addEventListener("click", ()=>{
  scanOn = !scanOn;
  const sl = document.querySelector(".scanlines");
  if (sl) sl.style.display = scanOn ? "block" : "none";
  triggerGlitch();
});
triggerGlitchBtn.addEventListener("click", triggerGlitch);

hardReset.addEventListener("click", ()=>{
  grainOn = true; scanOn = true;
  const sl = document.querySelector(".scanlines");
  if (sl) sl.style.display = "block";
  document.getElementById("cinemaFX").style.display = "block";
  blurRange.value = "26";
  applyBlur(26);
  closeSeals();
  closeAllModals();
  triggerGlitch();
});

/* ================= INITIAL ================= */
hardStopMediaIfNotEntered();
</script>
</body>
</html>

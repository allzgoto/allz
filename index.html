<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Shadow Temple Interface</title>

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700&family=Inter:wght@400;500&display=swap" rel="stylesheet" />

<style>
:root{
  --ink:#07080b;
  --coal:#0b0d12;

  /* Shadow Fight vibe: frio + vermelho contido */
  --a: rgba(200,60,60,.70);
  --a2: rgba(200,60,60,.18);
  --a3: rgba(200,60,60,.10);

  --blue: rgba(120,170,255,.55);

  --line: rgba(255,255,255,.08);
  --txt: rgba(245,248,255,.92);
  --dim: rgba(245,248,255,.62);

  --blur-amount: 26px;
}

*{margin:0;padding:0;box-sizing:border-box;}
body{
  background:var(--ink);
  overflow:hidden;
  color:var(--txt);
  font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
}

/* ========= VIDEO LAYERS ========= */
#videoBlur{
  position:fixed;
  inset:-20%;
  width:140%;
  height:140%;
  object-fit:cover;
  filter: blur(var(--blur-amount)) brightness(.50) saturate(1.05) contrast(1.08);
  transform: translateZ(0);
  z-index:-5;
}
#video{
  position:fixed;
  inset:0;
  width:100%;
  height:100%;
  object-fit:cover;
  z-index:-4;
  background:black;
}

/* ========= FX ========= */
.scanlines{
  position:fixed;
  inset:0;
  background:repeating-linear-gradient(
    to bottom,
    rgba(255,255,255,0.02),
    rgba(255,255,255,0.02) 1px,
    transparent 1px,
    transparent 4px
  );
  pointer-events:none;
  z-index:3;
  mix-blend-mode:overlay;
  opacity:.55;
}

/* Vinheta suave (sem blush pesado) */
#cinemaFX{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:4;
}
#cinemaFX::before{
  content:"";
  position:absolute;
  inset:-20%;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='.35'/%3E%3C/svg%3E");
  opacity:.06;
  mix-blend-mode:overlay;
  transform: translateZ(0);
  animation:grain 6s steps(10) infinite;
}
#cinemaFX::after{
  content:"";
  position:absolute;
  inset:0;
  background:
    radial-gradient(circle at 50% 48%, transparent 0 62%, rgba(0,0,0,.44) 82%, rgba(0,0,0,.72) 100%),
    radial-gradient(circle at 55% 55%, rgba(200,60,60,.05), transparent 55%);
  opacity:.72;
}
@keyframes grain{
  0%{transform:translate(0,0)}
  10%{transform:translate(-2%, -3%)}
  20%{transform:translate(-4%, 2%)}
  30%{transform:translate(3%, -2%)}
  40%{transform:translate(2%, 4%)}
  50%{transform:translate(-3%, 2%)}
  60%{transform:translate(4%, 0%)}
  70%{transform:translate(0%, 3%)}
  80%{transform:translate(-2%, -2%)}
  90%{transform:translate(3%, 1%)}
  100%{transform:translate(0,0)}
}

/* Flash “ruptura” */
#glitchFlash{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:60;
  opacity:0;
  background:
    radial-gradient(circle at 50% 50%, rgba(200,60,60,.14), transparent 55%),
    repeating-linear-gradient(0deg, rgba(255,255,255,.05) 0 1px, transparent 1px 5px);
  mix-blend-mode:screen;
}
.glitch-on #glitchFlash{ animation:glitchFlash .55s steps(6) 1; }
@keyframes glitchFlash{
  0%{opacity:0}
  10%{opacity:1; transform:translateX(6px)}
  25%{opacity:.28; transform:translateX(-8px)}
  40%{opacity:1; transform:translateX(4px)}
  60%{opacity:.18; transform:translateX(-4px)}
  80%{opacity:.85; transform:translateX(2px)}
  100%{opacity:0; transform:none}
}

/* ========= LOADING ========= */
#loadingScreen{
  position:fixed;
  inset:0;
  background:radial-gradient(circle at center,#0a0c12,#000);
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  z-index:70;
  transition:opacity .6s ease;
  overflow:hidden;
}
.loading-text{
  letter-spacing:6px;
  margin-bottom:20px;
  font-size:11px;
  opacity:.82;
  text-align:center;
  animation:flicker 2.2s infinite;
  max-width:90vw;
  font-family:Cinzel, serif;
}
@keyframes flicker{0%,100%{opacity:.78}50%{opacity:1}}
.spinner{
  width:40px;height:40px;
  border:3px solid rgba(255,255,255,.08);
  border-top:3px solid rgba(200,60,60,.70);
  border-radius:50%;
  animation:spin 1s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}

#enterBox{
  margin-top:34px;
  padding:18px 70px;
  border-radius:12px;
  background:rgba(10,12,16,0.62);
  border:1px solid rgba(200,60,60,0.36);
  backdrop-filter:blur(18px);
  letter-spacing:8px;
  font-weight:700;
  font-size:13px;
  color:rgba(245,248,255,.92);
  text-shadow:0 0 16px rgba(200,60,60,.16);
  opacity:0;
  pointer-events:none;
  transition:.4s ease;
  cursor:pointer;
  user-select:none;
  font-family:Cinzel, serif;
}
#enterBox.show{opacity:1; pointer-events:auto;}
#enterHint{
  margin-top:12px;
  font-size:9px;
  letter-spacing:4px;
  opacity:0;
  transition:.35s ease;
  color:rgba(245,248,255,.72);
  text-shadow:0 0 14px rgba(200,60,60,.10);
  user-select:none;
}
#enterHint.show{opacity:.88;}

#enterFooterLeft{
  position:fixed;
  left:18px;
  bottom:12px;
  z-index:71;
  font-size:9px;
  letter-spacing:3px;
  opacity:.32;
  user-select:none;
  text-shadow:0 0 12px rgba(200,60,60,.08);
  font-family:Cinzel, serif;
}
body.entered #enterFooterLeft{ display:none; }

#versionTag{
  position:fixed;
  right:18px;
  bottom:12px;
  z-index:8;
  font-size:9px;
  letter-spacing:3px;
  opacity:.33;
  user-select:none;
  text-shadow:0 0 12px rgba(200,60,60,.08);
  font-family:Cinzel, serif;
}
#versionTag .v{opacity:.88;color:rgba(245,248,255,.80);}

/* ========= TOP CONTROLS (tela normal) ========= */
/* Só: Fullscreen + Pergaminho + Admin */
#topControls{
  position:fixed;
  top:16px;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  gap:10px;
  z-index:40;
  opacity:.94;
  transition:.18s ease;
  filter: drop-shadow(0 0 18px rgba(0,0,0,.35));
}
#topControls:hover{opacity:1}

.ctrlBtn{
  width:44px;height:36px;
  border-radius:14px;
  border:1px solid rgba(245,238,220,.10);
  background:
    radial-gradient(circle at 30% 30%, rgba(245,238,220,.06), transparent 58%),
    linear-gradient(180deg, rgba(10,12,16,.72), rgba(0,0,0,.55));
  backdrop-filter: blur(16px);
  cursor:pointer;
  display:grid;
  place-items:center;
  box-shadow:
    0 0 0 1px rgba(0,0,0,.30) inset,
    0 14px 38px rgba(0,0,0,.46);
  position:relative;
  overflow:hidden;
  color:rgba(245,248,255,.92);
}
.ctrlBtn:hover{transform: translateY(-1px)}
.ctrlBtn:active{transform: translateY(1px)}
.ctrlBtn svg{width:18px;height:18px;opacity:.92;filter: drop-shadow(0 0 10px rgba(0,0,0,.40));}

/* ========= SELOS (menu externo) ========= */
#socialControl{
  position:fixed;
  top:14px;
  right:18px;
  z-index:45;
  opacity:.93;
  transition:.18s ease;
}
#socialControl:hover{opacity:1}
.linkPill{
  height:36px;
  padding:0 12px;
  border-radius:999px;
  border:1px solid rgba(245,238,220,.10);
  background:
    radial-gradient(circle at 30% 30%, rgba(245,238,220,.06), transparent 60%),
    linear-gradient(180deg, rgba(10,12,16,.62), rgba(0,0,0,.38));
  backdrop-filter: blur(16px);
  cursor:pointer;
  display:flex;
  align-items:center;
  gap:8px;
  color:rgba(245,248,255,.90);
  letter-spacing:4px;
  font-size:9px;
  box-shadow:
    0 0 0 1px rgba(255,255,255,.03) inset,
    0 12px 34px rgba(0,0,0,.38);
  font-family:Cinzel, serif;
}
.linkPill svg{width:18px;height:18px;opacity:.92;}
.linkPill:hover{transform: translateY(-1px)}
.linkPill:active{transform: translateY(1px)}
@media (max-width: 520px){
  .linkPill span{display:none;}
  .linkPill{padding:0 10px;}
}

/* Node de selos */
#routesNode{
  position:fixed;
  top:52px;
  right:18px;
  z-index:46;
  display:none;
}
#routesNode.show{display:block;}
.routesBox{
  width:76px;
  padding:10px 8px;
  border-radius:16px;
  border:1px solid rgba(245,238,220,.10);
  background:linear-gradient(180deg, rgba(10,12,16,.54), rgba(0,0,0,.36));
  backdrop-filter: blur(18px);
  box-shadow:0 18px 54px rgba(0,0,0,.55);
  display:flex;
  flex-direction:column;
  gap:10px;
}
.routeBtn{
  width:58px;
  height:58px;
  border-radius:18px;
  border:1px solid rgba(245,238,220,.10);
  background:linear-gradient(180deg, rgba(0,0,0,.10), rgba(0,0,0,.34));
  box-shadow:0 0 0 1px rgba(0,0,0,.32) inset;
  display:grid;
  place-items:center;
  cursor:pointer;
  position:relative;
  opacity:0;
  transform:translateY(-6px);
}
#routesNode.show .routeBtn{ animation: dockIn .20s ease forwards; }
#routesNode.show .routeBtn:nth-child(1){animation-delay:.02s}
#routesNode.show .routeBtn:nth-child(2){animation-delay:.06s}
#routesNode.show .routeBtn:nth-child(3){animation-delay:.10s}
#routesNode.show .routeBtn:nth-child(4){animation-delay:.14s}
@keyframes dockIn{ to{opacity:1; transform:none;} }
.routeBtn:hover{transform:translateY(-1px)}
.routeBtn:active{transform:translateY(1px)}
.routeBtn svg{width:18px;height:18px;opacity:.92}

.routeTip{
  position:absolute;
  right: calc(100% + 10px);
  top:50%;
  transform:translateY(-50%) translateX(10px);
  opacity:0;
  pointer-events:none;
  transition:.18s ease;
  padding:9px 11px;
  border-radius:14px;
  border:1px solid rgba(245,238,220,.10);
  background:rgba(0,0,0,.46);
  backdrop-filter: blur(12px);
  box-shadow:0 14px 40px rgba(0,0,0,.50);
  white-space:nowrap;
  min-width: 180px;
  font-family:Cinzel, serif;
}
.routeTip .t{display:block;font-size:9px;letter-spacing:4px;color:rgba(245,248,255,.92);}
.routeTip .s{display:block;margin-top:3px;font-size:8px;letter-spacing:2px;color:rgba(245,248,255,.70);}
.routeBtn:hover .routeTip{opacity:1; transform:translateY(-50%) translateX(0);}

/* ========= MODAL BASE ========= */
.modal{
  position:fixed;
  inset:0;
  z-index:80;
  display:none;
}
.modal.show{display:block;}
.backdropClose{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.58);
  backdrop-filter: blur(14px);
}

/* ========= PILL BUTTONS ========= */
.pill{
  height:34px;
  padding:0 14px;
  border-radius:999px;
  border:1px solid rgba(245,238,220,.12);
  background:rgba(0,0,0,.30);
  color:rgba(245,248,255,.90);
  cursor:pointer;
  letter-spacing:3px;
  font-size:10px;
  box-shadow:0 0 0 1px rgba(0,0,0,.34) inset;
  font-family:Cinzel, serif;
}
.pill:hover{transform: translateY(-1px)}
.pill:active{transform: translateY(1px)}
.pill.danger{border-color: rgba(200,60,60,.22); color: rgba(255,230,230,.92);}

/* ========= VOLUME (ícone voltou + slider oculto) ========= */
#volumeControl{
  position:fixed;
  left:14px;
  bottom:14px;
  z-index:42;
  display:flex;
  align-items:center;
  gap:10px;
  opacity:.92;
  transition:.18s ease;
}
#volumeControl:hover{opacity:1}
.volBtn{
  width:46px;height:38px;
  border-radius:14px;
  border:1px solid rgba(245,238,220,.10);
  background:
    radial-gradient(circle at 30% 30%, rgba(245,238,220,.06), transparent 58%),
    linear-gradient(180deg, rgba(10,8,7,.66), rgba(0,0,0,.46));
  backdrop-filter: blur(14px);
  cursor:pointer;
  display:grid;
  place-items:center;
  box-shadow: 0 0 0 1px rgba(0,0,0,.32) inset, 0 18px 54px rgba(0,0,0,.50);
  color:rgba(245,238,220,.92);
  user-select:none;
}
.volBtn svg{width:20px;height:20px;opacity:.92;filter: drop-shadow(0 0 10px rgba(0,0,0,.35));}
.volBtn:hover{transform:translateY(-1px)}
.volBtn:active{transform:translateY(1px)}

.volPanel{
  height:38px;
  padding:0 12px;
  border-radius:999px;
  border:1px solid rgba(245,238,220,.10);
  background:rgba(0,0,0,.34);
  backdrop-filter: blur(14px);
  display:flex;
  align-items:center;
  gap:10px;
  box-shadow: 0 0 0 1px rgba(255,255,255,.03) inset, 0 16px 50px rgba(0,0,0,.46);
  transform-origin:left center;
  transform:scaleX(0.0);
  opacity:0;
  pointer-events:none;
  transition:.18s ease;
}
#volumeControl.open .volPanel{
  transform:scaleX(1);
  opacity:1;
  pointer-events:auto;
}
.volLabel{
  font-family:Cinzel, serif;
  font-size:9px;
  letter-spacing:4px;
  color:rgba(245,238,220,.78);
}
#volRange{width:160px}
#volNum{
  font-family:Cinzel, serif;
  font-size:9px;
  letter-spacing:3px;
  color:rgba(245,238,220,.78);
  min-width:34px;
  text-align:right;
}

/* ========= PERGAMINHO REAL + ANIMAÇÃO ========= */
#modalParchment .modalShell{
  position:absolute;
  inset:0;
  display:grid;
  place-items:center;
  pointer-events:none;
}
#modalParchment.show .modalShell{pointer-events:auto;}

.parchmentShell{
  width:min(980px, 92vw);
  height:min(680px, 86vh);
  position:relative;
  transform-origin:center top;
  opacity:0;
  transform:translateY(14px) scale(.94);
  filter: blur(.35px);
}
#modalParchment.show .parchmentShell{
  animation: scrollOpen .45s cubic-bezier(.2,.9,.22,1) forwards;
}
@keyframes scrollOpen{
  0%{opacity:0; transform:translateY(18px) scale(.90) rotateX(8deg);}
  60%{opacity:1; transform:translateY(-4px) scale(1.01) rotateX(0deg);}
  100%{opacity:1; transform:translateY(0) scale(1.0) rotateX(0deg); filter:none;}
}
.scrollRoll{
  position:absolute;
  top:50%;
  width:34px;
  height: calc(100% - 40px);
  transform:translateY(-50%);
  border-radius: 18px;
  background:
    linear-gradient(180deg, rgba(245,238,220,.16), rgba(0,0,0,.24)),
    radial-gradient(circle at 50% 20%, rgba(245,238,220,.18), transparent 60%);
  border:1px solid rgba(245,238,220,.10);
  box-shadow: 0 16px 48px rgba(0,0,0,.62);
  opacity:0;
}
.scrollRoll.left{left:-14px}
.scrollRoll.right{right:-14px}
#modalParchment.show .scrollRoll{ animation: rollIn .42s ease forwards; }
#modalParchment.show .scrollRoll.right{animation-delay:.06s}
@keyframes rollIn{
  0%{opacity:0; transform:translateY(-50%) scaleX(.1);}
  60%{opacity:.92; transform:translateY(-50%) scaleX(1.04);}
  100%{opacity:.78; transform:translateY(-50%) scaleX(1.0);}
}

.parchment{
  position:absolute;
  inset:0;
  border-radius: 26px;
  border:1px solid rgba(245,238,220,.20);
  box-shadow: 0 28px 88px rgba(0,0,0,.68);
  overflow:hidden;

  background:
    radial-gradient(circle at 22% 18%, rgba(245,238,220,.42), transparent 52%),
    radial-gradient(circle at 75% 78%, rgba(200,60,60,.16), transparent 55%),
    radial-gradient(circle at 50% 50%, rgba(245,238,220,.12), transparent 66%),
    linear-gradient(180deg, rgba(68,52,34,.94), rgba(20,16,12,.86));

  -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 600'%3E%3Cpath d='M70 35c55-30 110 8 170 2 60-6 80-25 140-17 60 8 120 30 175 20 55-10 110-30 155 5 30 25 25 70 45 115 20 45 35 95 20 150-15 55-35 90-45 135-10 45 10 95-25 130-35 35-95 15-150 30-55 15-110 55-170 30-60-25-95-45-155-35-60 10-120 45-170 10-50-35-30-90-55-140-25-50-70-95-60-155 10-60 50-95 55-145 5-50-35-110 20-145Z' fill='%23000'/%3E%3C/svg%3E");
  -webkit-mask-size: 100% 100%;
  -webkit-mask-repeat: no-repeat;
  mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 600'%3E%3Cpath d='M70 35c55-30 110 8 170 2 60-6 80-25 140-17 60 8 120 30 175 20 55-10 110-30 155 5 30 25 25 70 45 115 20 45 35 95 20 150-15 55-35 90-45 135-10 45 10 95-25 130-35 35-95 15-150 30-55 15-110 55-170 30-60-25-95-45-155-35-60 10-120 45-170 10-50-35-30-90-55-140-25-50-70-95-60-155 10-60 50-95 55-145 5-50-35-110 20-145Z' fill='%23000'/%3E%3C/svg%3E");
  mask-size: 100% 100%;
  mask-repeat: no-repeat;
}
.parchment::before{
  content:"";
  position:absolute;
  inset:-25%;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='260' height='260'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.55' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='.85'/%3E%3C/svg%3E");
  opacity:.18;
  mix-blend-mode:overlay;
  pointer-events:none;
}
.parchment::after{
  content:"";
  position:absolute;
  inset:0;
  background:
    radial-gradient(circle at 50% 50%, transparent 0 58%, rgba(0,0,0,.52) 84%, rgba(0,0,0,.84) 100%);
  opacity:.72;
  pointer-events:none;
}

.parchHeader{
  position:relative;
  z-index:2;
  padding:16px 18px 12px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  border-bottom:1px solid rgba(245,238,220,.14);
}
.parchTitle{
  font-family:Cinzel, serif;
  letter-spacing:7px;
  font-size:12px;
  color:rgba(245,238,220,.92);
  text-shadow: 0 18px 44px rgba(0,0,0,.65);
}
.parchTitle small{
  margin-left:10px;
  letter-spacing:3px;
  opacity:.62;
  font-family:Inter, sans-serif;
}
.parchActions{display:flex; gap:10px; align-items:center;}

.parchBody{
  position:relative;
  z-index:2;
  padding:18px 22px;
  height: calc(100% - 58px);
  overflow:auto;
  color:rgba(245,238,220,.92);
  font-family:Cinzel, serif;
  font-size:16px;
  line-height:1.85;
  letter-spacing:1px;
  text-align:center;
  text-shadow: 0 12px 32px rgba(0,0,0,.70);
}
.parchBody .verse{
  margin: 18px auto;
  max-width: 760px;
  opacity:.92;
}
.parchBody .verse.dim{opacity:.78}
.parchBody .sig{
  margin-top:26px;
  font-size:11px;
  letter-spacing:6px;
  opacity:.62;
}

/* ========= ADMIN (modal simples) ========= */
.adminBox{
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
  width:min(980px, calc(100vw - 48px));
  border-radius:16px;
  border:1px solid rgba(245,238,220,.10);
  background:linear-gradient(180deg, rgba(10,12,16,.78), rgba(0,0,0,.62));
  box-shadow:0 18px 66px rgba(0,0,0,.62);
  overflow:hidden;
}
.adminHeader{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px 12px;
  font-size:10px;
  letter-spacing:4px;
  opacity:.88;
  border-bottom:1px solid rgba(255,255,255,.07);
  font-family:Cinzel, serif;
}
.adminHeader .dim{opacity:.55}
.adminBody{ padding:14px; }

.adminField{
  border-radius:14px;
  border:1px solid rgba(245,238,220,.10);
  background:linear-gradient(180deg, rgba(0,0,0,.16), rgba(0,0,0,.28));
  box-shadow:0 0 0 1px rgba(0,0,0,.28) inset;
  padding:12px;
}
.adminLabel{ font-size:9px; letter-spacing:3px; opacity:.55; margin-bottom:8px; font-family:Cinzel, serif;}
.adminValue{ font-size:14px; letter-spacing:2px; opacity:.92; font-family:Cinzel, serif;}
.adminInput{
  width:100%;
  height:40px;
  border-radius:12px;
  border:1px solid rgba(245,238,220,.10);
  background:rgba(0,0,0,.35);
  color:rgba(245,248,255,.92);
  padding:0 12px;
  font-family:Inter, system-ui, sans-serif;
  letter-spacing:.5px;
  font-size:12px;
  outline:none;
  box-shadow:0 0 0 1px rgba(0,0,0,.28) inset;
}
.adminActions{
  margin-top:12px;
  display:flex;
  align-items:center;
  gap:10px;
  flex-wrap:wrap;
}
.aPill{
  font-size:10px;
  letter-spacing:2px;
  opacity:.82;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.08);
  background:rgba(0,0,0,.22);
  font-family:Cinzel, serif;
}
.aPill.ok{ border-color: rgba(245,238,220,.12); }
.aPill.bad{ border-color: rgba(200,60,60,.22); color: rgba(255,220,220,.92); }

/* ========= SELOS MODALS (terminal / arquivos / social / arena) ========= */
.modalBox{
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
  width:min(980px, calc(100vw - 48px));
  max-height: min(78vh, 820px);
  border-radius:16px;
  border:1px solid rgba(245,238,220,.10);
  background:linear-gradient(180deg, rgba(10,12,16,.78), rgba(0,0,0,.62));
  box-shadow:0 18px 66px rgba(0,0,0,.62);
  overflow:hidden;
}
.modalHeader{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px 12px;
  font-size:10px;
  letter-spacing:4px;
  opacity:.88;
  border-bottom:1px solid rgba(255,255,255,.07);
  font-family:Cinzel, serif;
}
.modalHeader .dim{opacity:.55}
.modalBody{ padding:14px; overflow:auto; max-height: calc(min(78vh, 820px) - 48px); }

/* Terminal (GRIMÓRIO dentro de SELOS) */
.termLog{
  background:rgba(0,0,0,.28);
  border:1px solid rgba(245,238,220,.10);
  border-radius:14px;
  padding:12px;
  min-height:220px;
  max-height:44vh;
  overflow:auto;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
  font-size:12px;
  line-height:1.55;
  color:rgba(245,248,255,.90);
}
.termInputRow{
  margin-top:10px;
  display:flex;
  gap:10px;
  align-items:center;
}
.termPrompt{
  font-family:Cinzel, serif;
  letter-spacing:3px;
  font-size:10px;
  opacity:.75;
}
.termInput{
  flex:1;
  height:36px;
  border-radius:12px;
  border:1px solid rgba(245,238,220,.10);
  background:rgba(0,0,0,.35);
  color:rgba(245,248,255,.92);
  padding:0 12px;
  outline:none;
}

/* Cartões simples */
.grid2{
  display:grid;
  grid-template-columns:repeat(2, minmax(0,1fr));
  gap:12px;
}
@media (max-width: 900px){ .grid2{grid-template-columns:1fr;} }

.card{
  border-radius:14px;
  border:1px solid rgba(245,238,220,.10);
  background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(0,0,0,.22));
  padding:14px;
  box-shadow:0 0 0 1px rgba(0,0,0,.28) inset;
}
.card h3{
  font-family:Cinzel, serif;
  letter-spacing:4px;
  font-size:12px;
  margin-bottom:8px;
}
.card p{opacity:.78; font-size:11px; line-height:1.55;}
.card a{
  display:inline-flex;
  margin-top:10px;
  text-decoration:none;
  color:rgba(245,248,255,.92);
}

@media (max-width: 560px){
  #volRange{width:120px;}
  .parchBody{font-size:14px; padding:14px 14px;}
}

/* reduced motion */
@media (prefers-reduced-motion: reduce){
  .spinner{animation:none}
  #cinemaFX::before{animation:none}
  #routesNode.show .routeBtn{animation:none; opacity:1; transform:none;}
}
</style>
</head>
<body>

<!-- VIDEO -->
<video id="videoBlur" playsinline preload="auto" muted loop>
  <source src="https://files.catbox.moe/klaol5.webm" type="video/webm" />
</video>

<video id="video" playsinline preload="auto" loop>
  <source src="https://files.catbox.moe/klaol5.webm" type="video/webm" />
</video>

<!-- ÁUDIO AMBIENTE -->
<audio id="ambience" preload="auto" loop>
  <source src="https://files.catbox.moe/99fu05.m4a" type="audio/mp4">
</audio>

<div class="scanlines"></div>
<div id="cinemaFX"></div>
<div id="glitchFlash"></div>

<!-- version -->
<div id="versionTag"><span class="v">shadow temple interface: v2</span></div>

<!-- LOADING / ENTER -->
<div id="loadingScreen">
  <div class="loading-text" id="dynamicText">O TEMPLO OBSERVA…</div>
  <div class="spinner" id="spinner"></div>

  <div id="enterBox">ENTRAR</div>
  <div id="enterHint">PRESSIONE [ENTER] PARA PROSSEGUIR</div>

  <div id="enterFooterLeft">SELO ATIVO // PASSO PROIBIDO</div>
</div>

<!-- TOP CONTROLS (tela normal) -->
<div id="topControls" aria-label="Controles">
  <!-- FULLSCREEN -->
  <button class="ctrlBtn" id="btnFS" title="Tela Cheia" aria-label="Tela cheia">
    <!-- “portal frame” (menos tech) -->
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <path d="M7 4H5a2 2 0 0 0-2 2v2M17 4h2a2 2 0 0 1 2 2v2M7 20H5a2 2 0 0 1-2-2v-2M17 20h2a2 2 0 0 0 2-2v-2"
        fill="none" stroke="rgba(245,238,220,.90)" stroke-width="1.7" stroke-linecap="round"/>
      <path d="M9 9c2-2 4-2 6 0M9 15c2 2 4 2 6 0"
        fill="none" stroke="rgba(200,60,60,.65)" stroke-width="1.6" stroke-linecap="round"/>
    </svg>
  </button>

  <!-- PERGAMINHO (novo) -->
  <button class="ctrlBtn" id="btnParch" title="Pergaminho" aria-label="Pergaminho">
    <!-- “scroll” -->
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <path d="M7 5h9a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H9"
        fill="none" stroke="rgba(245,238,220,.88)" stroke-width="1.7" stroke-linejoin="round"/>
      <path d="M7 5v12a2 2 0 0 0 2 2h0"
        fill="none" stroke="rgba(245,238,220,.70)" stroke-width="1.7" stroke-linecap="round"/>
      <path d="M10 9h6M10 12h6M10 15h5"
        fill="none" stroke="rgba(200,60,60,.60)" stroke-width="1.6" stroke-linecap="round"/>
    </svg>
  </button>

  <!-- ADMIN -->
  <button class="ctrlBtn" id="btnAdmin" title="Câmara" aria-label="Câmara">
    <!-- “mask” -->
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <path d="M12 3c4.5 0 8 2.6 8 7.5 0 7-5.2 10.5-8 10.5S4 17.5 4 10.5C4 5.6 7.5 3 12 3Z"
        fill="none" stroke="rgba(245,238,220,.86)" stroke-width="1.6" stroke-linejoin="round"/>
      <path d="M9 11.2c.8-1.1 2-.9 3 0m3 0c.8-1.1 2-.9 3 0"
        fill="none" stroke="rgba(200,60,60,.58)" stroke-width="1.6" stroke-linecap="round"/>
      <path d="M9.2 15.2c1 .8 2 .9 2.8.9s1.8-.1 2.8-.9"
        fill="none" stroke="rgba(245,238,220,.62)" stroke-width="1.6" stroke-linecap="round"/>
    </svg>
  </button>
</div>

<!-- SELOS (menu) -->
<div id="socialControl" aria-label="Selos">
  <button class="linkPill" id="btnLinks" type="button" title="SELOS" aria-label="Abrir selos">
    <!-- “sigil” -->
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <path d="M12 3.7 19 8v8l-7 4.3L5 16V8l7-4.3Z"
        fill="none" stroke="rgba(245,238,220,.88)" stroke-width="1.6" stroke-linejoin="round"/>
      <path d="M12 7v10M8.5 10.2 12 12l3.5-1.8"
        fill="none" stroke="rgba(200,60,60,.62)" stroke-width="1.6" stroke-linecap="round"/>
    </svg>
    <span>SELOS</span>
  </button>
</div>

<!-- ROUTES NODE (itens ficam AQUI dentro do SELOS) -->
<div id="routesNode" aria-hidden="true">
  <div class="routesBox" role="navigation" aria-label="Selos externos">
    <button class="routeBtn" id="rSocial" type="button" aria-label="Sociais">
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path d="M8 12a4 4 0 1 1 0-8h2M16 12a4 4 0 1 0 0-8h-2"
          fill="none" stroke="rgba(245,238,220,.86)" stroke-width="1.7" stroke-linecap="round"/>
        <path d="M10 12h4"
          fill="none" stroke="rgba(200,60,60,.70)" stroke-width="1.8" stroke-linecap="round"/>
      </svg>
      <span class="routeTip" aria-hidden="true"><span class="t">SOCIAIS</span><span class="s">Discord / Instagram</span></span>
    </button>

    <button class="routeBtn" id="rFiles" type="button" aria-label="Arquivos">
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path d="M6 7h12v4H6V7Z" fill="none" stroke="rgba(245,238,220,.86)" stroke-width="1.6" stroke-linejoin="round"/>
        <path d="M7 11v9h10v-9" fill="none" stroke="rgba(245,238,220,.70)" stroke-width="1.6" stroke-linejoin="round"/>
        <path d="M10 15h4" fill="none" stroke="rgba(200,60,60,.65)" stroke-width="1.6" stroke-linecap="round"/>
      </svg>
      <span class="routeTip" aria-hidden="true"><span class="t">ARQUIVOS</span><span class="s">Índice selado</span></span>
    </button>

    <button class="routeBtn" id="rGrimoire" type="button" aria-label="Grimório (Terminal)">
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <circle cx="12" cy="12" r="8.2" fill="none" stroke="rgba(245,238,220,.86)" stroke-width="1.6"/>
        <path d="M12 7.5v9M7.5 12h9"
          fill="none" stroke="rgba(200,60,60,.65)" stroke-width="1.6" stroke-linecap="round"/>
      </svg>
      <span class="routeTip" aria-hidden="true"><span class="t">GRIMÓRIO</span><span class="s">Terminal antigo</span></span>
    </button>

    <button class="routeBtn" id="rArena" type="button" aria-label="Arena">
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path d="M4 20l6-2 10-10-4-4L6 14l-2 6Z" fill="none" stroke="rgba(245,238,220,.86)" stroke-width="1.6" stroke-linejoin="round"/>
        <path d="M14 6l4 4" fill="none" stroke="rgba(200,60,60,.55)" stroke-width="1.6" stroke-linecap="round"/>
      </svg>
      <span class="routeTip" aria-hidden="true"><span class="t">ARENA</span><span class="s">Hub / vitrine</span></span>
    </button>
  </div>
</div>

<!-- VOLUME (vol inicial 45% — no JS) -->
<div id="volumeControl" aria-label="Volume">
  <button class="volBtn" id="btnVol" type="button" aria-label="Abrir volume">
    <!-- ícone “sino/war drum” (shadow vibe) -->
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <path d="M12 4c3 0 5 2.2 5 5v2c0 1.8.7 3 1.7 4l.3.3H5l.3-.3C6.3 14 7 12.8 7 11V9c0-2.8 2-5 5-5Z"
        fill="none" stroke="rgba(245,238,220,.90)" stroke-width="1.6" stroke-linejoin="round"/>
      <path d="M10 18.6c.4 1 1.1 1.6 2 1.6s1.6-.6 2-1.6"
        fill="none" stroke="rgba(200,60,60,.65)" stroke-width="1.6" stroke-linecap="round"/>
      <path d="M12 6.2v2.2"
        fill="none" stroke="rgba(245,238,220,.60)" stroke-width="1.4" stroke-linecap="round"/>
    </svg>
  </button>

  <div class="volPanel" id="volPanel" role="group" aria-label="Ajuste de volume">
    <div class="volLabel">ECO</div>
    <input id="volRange" type="range" min="0" max="1" step="0.01" value="0.45" />
    <div id="volNum">45%</div>
  </div>
</div>

<!-- ========= MODAL: PERGAMINHO ========= -->
<div id="modalParchment" class="modal" aria-hidden="true">
  <div class="backdropClose" data-close="parchment"></div>

  <div class="modalShell">
    <div class="parchmentShell" role="dialog" aria-label="Pergaminho">
      <div class="scrollRoll left" aria-hidden="true"></div>
      <div class="scrollRoll right" aria-hidden="true"></div>

      <div class="parchment">
        <div class="parchHeader">
          <div class="parchTitle">PERGAMINHO <small>// ESC fecha</small></div>
          <div class="parchActions">
            <button class="pill" id="parchRupture" type="button">RUPTURA</button>
            <button class="pill danger" id="parchClose" type="button">FECHAR</button>
          </div>
        </div>

        <div class="parchBody" id="parchBody">
          <div class="verse">NO INÍCIO, O TEMPLO RESPIRAVA EM SILÊNCIO.</div>
          <div class="verse dim">E A SOMBRA CAMINHAVA SEM ROSTO, SEM NOME, SEM LUZ.</div>
          <div class="verse">O PORTAL TREMEU. O SELO RACHOU.</div>
          <div class="verse dim">E A ARENA PEDIA SANGUE, FERRO E DISCIPLINA.</div>
          <div class="verse">SE VOCÊ ABRIR ISTO, NÃO VOLTA IGUAL.</div>

          <div class="sig">Σ  Δ  Ψ  //  JURAMENTO DO SOMBRA</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ========= MODAL: ADMIN ========= -->
<div id="modalAdmin" class="modal" aria-hidden="true">
  <div class="backdropClose" data-close="admin"></div>

  <div class="adminBox" role="dialog" aria-label="Admin">
    <div class="adminHeader">
      <div>CÂMARA // CHAVE NECESSÁRIA</div>
      <div class="dim">ESC para fechar</div>
    </div>

    <div class="adminBody">
      <div id="adminLogin">
        <div class="adminField" style="margin-bottom:12px;">
          <div class="adminLabel">PORTADOR</div>
          <div class="adminValue">SOMBRA</div>
        </div>

        <div class="adminField">
          <div class="adminLabel">CHAVE</div>
          <input id="adminPass" class="adminInput" type="password" autocomplete="off" spellcheck="false" placeholder="•••••••••" />
        </div>

        <div class="adminActions">
          <button class="pill" id="adminAuth" type="button">ABRIR</button>
          <button class="pill" id="adminClear" type="button">LIMPAR</button>
          <div id="adminStatus" class="aPill">Aguardando…</div>
        </div>
      </div>

      <div id="adminDash" style="display:none;">
        <div class="adminField" style="margin-bottom:12px;">
          <div class="adminLabel">MÉTRICAS (LOCAL)</div>
          <div class="adminValue">
            ENTRADAS: <span id="mViews">0</span> &nbsp;&nbsp;|&nbsp;&nbsp;
            DISPOSITIVO: <span id="mUnique">0</span> &nbsp;&nbsp;|&nbsp;&nbsp;
            ÚLTIMO: <span id="mLast">—</span>
          </div>
        </div>

        <div class="adminActions">
          <button class="pill danger" id="adminReset" type="button">ZERAR</button>
          <button class="pill" id="adminLock" type="button">SELAR</button>
          <div class="aPill ok">SEM BACKEND</div>
        </div>

        <div style="margin-top:10px; opacity:.65; font-size:11px; line-height:1.5;">
          Nota: isso conta só neste navegador. Sem servidor, não existe contagem global real.
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ========= MODAL: SOCIAIS ========= -->
<div id="modalSocial" class="modal" aria-hidden="true">
  <div class="backdropClose" data-close="social"></div>
  <div class="modalBox" role="dialog" aria-label="Sociais">
    <div class="modalHeader">
      <div>SELOS SOCIAIS</div>
      <div class="dim">ESC para fechar</div>
    </div>
    <div class="modalBody">
      <div class="grid2">
        <div class="card">
          <h3>DISCORD</h3>
          <p>Porta de comunicação. Troque o link depois.</p>
          <a class="pill" href="https://discord.gg/example" target="_blank" rel="noopener noreferrer">ABRIR</a>
        </div>
        <div class="card">
          <h3>INSTAGRAM</h3>
          <p>Arquivo visual. Troque o link depois.</p>
          <a class="pill" href="https://instagram.com/example" target="_blank" rel="noopener noreferrer">ABRIR</a>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ========= MODAL: ARQUIVOS ========= -->
<div id="modalFiles" class="modal" aria-hidden="true">
  <div class="backdropClose" data-close="files"></div>
  <div class="modalBox" role="dialog" aria-label="Arquivos">
    <div class="modalHeader">
      <div>ARQUIVOS // ÍNDICE SELADO</div>
      <div class="dim">ESC para fechar</div>
    </div>
    <div class="modalBody">
      <div class="grid2">
        <div class="card">
          <h3>IMAGENS</h3>
          <p>Galeria / prints / referências. (placeholder)</p>
          <button class="pill" type="button" onclick="triggerGlitch()">TESTAR RUPTURA</button>
        </div>
        <div class="card">
          <h3>MODS & PACKS</h3>
          <p>Links e arquivos externos. (placeholder)</p>
          <button class="pill" type="button" onclick="triggerGlitch()">ABRIR SELO</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ========= MODAL: GRIMÓRIO (terminal antigo dentro de SELOS) ========= -->
<div id="modalGrimoire" class="modal" aria-hidden="true">
  <div class="backdropClose" data-close="grimoire"></div>
  <div class="modalBox" role="dialog" aria-label="Grimório">
    <div class="modalHeader">
      <div>GRIMÓRIO // CONSOLE</div>
      <div class="dim">ESC para fechar</div>
    </div>
    <div class="modalBody">
      <div id="termLog" class="termLog"></div>
      <div class="termInputRow">
        <div class="termPrompt" id="termPrompt">shadow@temple:~$</div>
        <input id="termInput" class="termInput" type="text" autocomplete="off" spellcheck="false" placeholder="Digite um comando (help)" />
        <button class="pill" id="termSend" type="button">ENVIAR</button>
      </div>
    </div>
  </div>
</div>

<!-- ========= MODAL: ARENA (placeholder) ========= -->
<div id="modalArena" class="modal" aria-hidden="true">
  <div class="backdropClose" data-close="arena"></div>
  <div class="modalBox" role="dialog" aria-label="Arena">
    <div class="modalHeader">
      <div>ARENA</div>
      <div class="dim">ESC para fechar</div>
    </div>
    <div class="modalBody">
      <div class="card">
        <h3>HUB</h3>
        <p>Placeholder. Depois a gente troca isso pelo layout do teu “GAME OS”.</p>
      </div>
    </div>
  </div>
</div>

<!-- ========= SCRIPT (PARTE 3 vem agora) ========= -->
<script>
/* =========================
   PARTE 3/3 — JAVASCRIPT
   (cola exatamente onde terminou: depois do "<script>")
========================= */

/* ===== ELEMENTS ===== */
const video = document.getElementById("video");
const videoBlur = document.getElementById("videoBlur");
const ambience = document.getElementById("ambience");

const loadingScreen = document.getElementById("loadingScreen");
const dynamicText = document.getElementById("dynamicText");
const spinner = document.getElementById("spinner");
const enterBox = document.getElementById("enterBox");
const enterHint = document.getElementById("enterHint");

/* Top buttons */
const btnFS = document.getElementById("btnFS");
const btnParch = document.getElementById("btnParch");
const btnAdmin = document.getElementById("btnAdmin");

/* SELOS */
const btnLinks = document.getElementById("btnLinks");
const routesNode = document.getElementById("routesNode");
const rSocial = document.getElementById("rSocial");
const rFiles = document.getElementById("rFiles");
const rGrimoire = document.getElementById("rGrimoire");
const rArena = document.getElementById("rArena");

/* Volume */
const btnVol = document.getElementById("btnVol");
const volPanel = document.getElementById("volPanel");
const volRange = document.getElementById("volRange");
const volNum = document.getElementById("volNum");

/* Pergaminho */
const modalParchment = document.getElementById("modalParchment");
const parchClose = document.getElementById("parchClose");
const parchRupture = document.getElementById("parchRupture");

/* Admin */
const modalAdmin = document.getElementById("modalAdmin");
const adminLogin = document.getElementById("adminLogin");
const adminDash = document.getElementById("adminDash");
const adminPass = document.getElementById("adminPass");
const adminAuth = document.getElementById("adminAuth");
const adminClear = document.getElementById("adminClear");
const adminStatus = document.getElementById("adminStatus");
const adminReset = document.getElementById("adminReset");
const adminLock = document.getElementById("adminLock");
const mViews = document.getElementById("mViews");
const mUnique = document.getElementById("mUnique");
const mLast = document.getElementById("mLast");

/* Modais do SELOS */
const modalSocial = document.getElementById("modalSocial");
const modalFiles = document.getElementById("modalFiles");
const modalGrimoire = document.getElementById("modalGrimoire");
const modalArena = document.getElementById("modalArena");

/* Terminal (Grimório dentro do SELOS) */
const termLog = document.getElementById("termLog");
const termInput = document.getElementById("termInput");
const termPrompt = document.getElementById("termPrompt");
const termSend = document.getElementById("termSend");

/* ===== FLAGS ===== */
let hasEntered = false;
let readyToEnter = false;

/* =========================
   MEDIA SAFE START
========================= */
function hardStopMediaIfNotEntered(){
  if (hasEntered) return;
  try { video.pause(); video.currentTime = 0; } catch(e){}
  try { videoBlur.pause(); videoBlur.currentTime = 0; } catch(e){}
  try { ambience.pause(); ambience.currentTime = 0; } catch(e){}
}
document.addEventListener("DOMContentLoaded", hardStopMediaIfNotEntered);
window.addEventListener("pageshow", hardStopMediaIfNotEntered);

/* ===== LOADING TEXT ROTATE ===== */
const messages = [
  "O TEMPLO OBSERVA…",
  "SELOS SE FECHAM…",
  "O PORTAL RESPIRA…",
  "SOMBRA EM SILÊNCIO…",
  "PRESENÇA DETECTADA…",
  "UM PASSO E NÃO VOLTA…"
];
let msgIndex = 0;
setInterval(() => {
  if (hasEntered) return;
  msgIndex = (msgIndex + 1) % messages.length;
  dynamicText.textContent = messages[msgIndex];
}, 2200);

/* ===== READY / SAFETY ===== */
function markReady(){
  if (readyToEnter) return;
  readyToEnter = true;
  enterBox.classList.add("show");
  enterHint.classList.add("show");
}
video.addEventListener("loadeddata", markReady, { once:true });
video.addEventListener("canplay", markReady, { once:true });

setTimeout(() => {
  if (!readyToEnter){
    dynamicText.textContent = "SINAL FRACO // ENTRADA MANUAL LIBERADA";
    markReady();
  }
}, 9000);

/* ===== ENTER ACTION ===== */
async function doEnter(){
  if (hasEntered) return;
  hasEntered = true;
  document.body.classList.add("entered");

  // some loading
  loadingScreen.style.opacity = "0";
  setTimeout(() => { loadingScreen.style.display = "none"; }, 600);

  // volumes (pedido: vídeo 45%)
  video.volume = 0.45;
  volRange.value = "0.45";
  updateVolUI();

  // play
  try { await video.play(); } catch(e){}
  try { await videoBlur.play(); } catch(e){}
  try { await ambience.play(); } catch(e){}

  // métricas
  bumpMetrics();
}
enterBox.addEventListener("click", doEnter);
document.addEventListener("keydown", (e) => {
  if (!hasEntered && e.key === "Enter") doEnter();
});

/* ===== Visibility pause ===== */
document.addEventListener("visibilitychange", () => {
  if (document.hidden){
    try{ video.pause(); }catch(e){}
    try{ videoBlur.pause(); }catch(e){}
    try{ ambience.pause(); }catch(e){}
    return;
  }
  if (!hasEntered){
    hardStopMediaIfNotEntered();
    return;
  }
  video.play().catch(()=>{});
  videoBlur.play().catch(()=>{});
  ambience.play().catch(()=>{});
});

/* =========================
   FULLSCREEN
========================= */
async function toggleFullscreen(){
  try{
    if (!document.fullscreenElement) await document.documentElement.requestFullscreen();
    else await document.exitFullscreen();
  }catch(e){}
}
btnFS.addEventListener("click", toggleFullscreen);

/* =========================
   GLITCH / RUPTURA
========================= */
function triggerGlitch(){
  document.body.classList.remove("glitch-on");
  void document.body.offsetWidth;
  document.body.classList.add("glitch-on");
  setTimeout(()=>document.body.classList.remove("glitch-on"), 700);
}
window.triggerGlitch = triggerGlitch;

/* =========================
   VOLUME UI (45% default)
========================= */
function updateVolUI(){
  const pct = Math.round(Number(video.volume) * 100);
  volNum.textContent = pct + "%";
  // amb menor
  ambience.volume = Math.min(0.28, Math.max(0.02, Number(video.volume) * 0.18));
}
updateVolUI();

btnVol.addEventListener("click", (e) => {
  e.stopPropagation();
  volPanel.classList.toggle("open");
});
document.addEventListener("click", () => volPanel.classList.remove("open"));
volRange.addEventListener("input", () => {
  video.volume = Number(volRange.value);
  updateVolUI();
});

/* =========================
   MODAL HELPERS
========================= */
function openModal(el){
  if (!el) return;
  el.classList.add("show");
  el.setAttribute("aria-hidden", "false");
}
function closeModal(el){
  if (!el) return;
  el.classList.remove("show");
  el.setAttribute("aria-hidden", "true");
}

/* backdrop click */
document.querySelectorAll(".backdropClose").forEach(bg => {
  bg.addEventListener("click", () => {
    const key = bg.getAttribute("data-close");
    if (key === "parchment") closeModal(modalParchment);
    if (key === "admin") closeModal(modalAdmin);
    if (key === "social") closeModal(modalSocial);
    if (key === "files") closeModal(modalFiles);
    if (key === "grimoire") closeModal(modalGrimoire);
    if (key === "arena") closeModal(modalArena);
  });
});

/* ESC fecha tudo */
document.addEventListener("keydown", (e) => {
  if (e.key !== "Escape") return;

  // fecha SELOS node
  routesNode.classList.remove("show");

  // fecha modais
  [modalParchment, modalAdmin, modalSocial, modalFiles, modalGrimoire, modalArena]
    .forEach(closeModal);

  // fecha volume
  volPanel.classList.remove("open");
});

/* =========================
   SELOS MENU (somente por botão)
========================= */
btnLinks.addEventListener("click", (e) => {
  e.stopPropagation();
  routesNode.classList.toggle("show");
});
document.addEventListener("click", () => routesNode.classList.remove("show"));

/* Rotas do SELOS */
rSocial.addEventListener("click", () => { routesNode.classList.remove("show"); openModal(modalSocial); });
rFiles.addEventListener("click", () => { routesNode.classList.remove("show"); openModal(modalFiles); });
rGrimoire.addEventListener("click", () => { routesNode.classList.remove("show"); openModal(modalGrimoire); seedTerminal(); });
rArena.addEventListener("click", () => { routesNode.classList.remove("show"); openModal(modalArena); });

/* =========================
   PERGAMINHO (tela normal)
========================= */
btnParch.addEventListener("click", () => {
  openModal(modalParchment);
  // animação de abrir (CSS já faz)
  triggerGlitch();
});
parchClose.addEventListener("click", () => closeModal(modalParchment));
parchRupture.addEventListener("click", () => triggerGlitch());

/* =========================
   ADMIN (tela normal)
========================= */
btnAdmin.addEventListener("click", () => openModal(modalAdmin));

/* =========================
   ADMIN MÉTRICAS (localStorage)
========================= */
const KEY = {
  views: "st_views",
  uniq: "st_uniq",
  last: "st_last",
  lock: "st_lock"
};
function nowStamp(){
  const d = new Date();
  const pad = (n) => String(n).padStart(2,"0");
  return `${pad(d.getDate())}/${pad(d.getMonth()+1)}/${d.getFullYear()} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
}
function getOrSetUnique(){
  const uKey = "st_unique_id";
  let id = localStorage.getItem(uKey);
  if (!id){
    id = "u_" + Math.random().toString(16).slice(2) + Date.now().toString(16);
    localStorage.setItem(uKey, id);
  }
  return id;
}
function bumpMetrics(){
  // views
  const v = Number(localStorage.getItem(KEY.views) || "0") + 1;
  localStorage.setItem(KEY.views, String(v));
  localStorage.setItem(KEY.last, nowStamp());

  // uniq (por navegador)
  getOrSetUnique();
  localStorage.setItem(KEY.uniq, "1");

  renderMetrics();
}
function renderMetrics(){
  mViews.textContent = localStorage.getItem(KEY.views) || "0";
  mUnique.textContent = localStorage.getItem(KEY.uniq) || "0";
  mLast.textContent = localStorage.getItem(KEY.last) || "—";
}
renderMetrics();

/* Auth simples (local) */
function setAdminStatus(text, cls){
  adminStatus.textContent = text;
  adminStatus.classList.remove("ok","bad");
  if (cls) adminStatus.classList.add(cls);
}
adminAuth.addEventListener("click", () => {
  const pass = (adminPass.value || "").trim();
  if (!pass){
    setAdminStatus("Digite a chave.", "bad");
    return;
  }
  // chave simples (troca depois)
  if (pass === "shadow"){
    adminLogin.style.display = "none";
    adminDash.style.display = "block";
    setAdminStatus("ABERTO", "ok");
    renderMetrics();
  } else {
    setAdminStatus("CHAVE INVÁLIDA", "bad");
  }
});
adminClear.addEventListener("click", () => {
  adminPass.value = "";
  setAdminStatus("Aguardando…");
});
adminReset.addEventListener("click", () => {
  localStorage.setItem(KEY.views, "0");
  localStorage.setItem(KEY.last, "—");
  renderMetrics();
  setAdminStatus("ZERADO", "ok");
});
adminLock.addEventListener("click", () => {
  // só fecha modal
  closeModal(modalAdmin);
});

/* =========================
   TERMINAL (GRIMÓRIO — dentro do SELOS)
========================= */
function logLine(html){
  const div = document.createElement("div");
  div.className = "termLine";
  div.innerHTML = html;
  termLog.appendChild(div);
  termLog.scrollTop = termLog.scrollHeight;
}
function seedTerminal(){
  if (termLog.dataset.seeded === "1") return;
  termLog.dataset.seeded = "1";
  logLine("<span class='dim'>[SISTEMA]</span> Grimório acordado.");
  logLine("<span class='dim'>[DICA]</span> Digite <b>help</b>, <b>seal</b>, <b>arena</b>, <b>rupture</b>.");
}
function handleCmd(cmdRaw){
  const cmd = (cmdRaw || "").trim().toLowerCase();
  if (!cmd) return;

  logLine(`<span class="dim">${termPrompt.textContent}</span> ${escapeHtml(cmdRaw)}`);

  if (cmd === "help"){
    logLine("Comandos: <b>help</b>, <b>seal</b>, <b>arena</b>, <b>rupture</b>, <b>clear</b>");
    return;
  }
  if (cmd === "seal"){
    logLine("Selos: <span class='dim'>SOCIAIS / ARQUIVOS / GRIMÓRIO / ARENA</span>");
    return;
  }
  if (cmd === "arena"){
    logLine("Abrindo ARENA…");
    openModal(modalArena);
    return;
  }
  if (cmd === "rupture"){
    logLine("RUPTURA disparada.");
    triggerGlitch();
    return;
  }
  if (cmd === "clear"){
    termLog.innerHTML = "";
    termLog.dataset.seeded = "1";
    logLine("<span class='dim'>[SISTEMA]</span> Registro apagado.");
    return;
  }
  logLine("<span class='dim'>Comando não reconhecido.</span>");
}
function escapeHtml(str){
  return String(str)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}
termSend.addEventListener("click", () => {
  handleCmd(termInput.value);
  termInput.value = "";
  termInput.focus();
});
termInput.addEventListener("keydown", (e) => {
  if (e.key === "Enter"){
    handleCmd(termInput.value);
    termInput.value = "";
  }
});

/* =========================
   FIX: não deixar nada “abrir sozinho”
========================= */
closeModal(modalParchment);
closeModal(modalAdmin);
closeModal(modalSocial);
closeModal(modalFiles);
closeModal(modalGrimoire);
closeModal(modalArena);
routesNode.classList.remove("show");
volPanel.classList.remove("open");

/* ====== FIM ====== */
</script>
</body>
</html>

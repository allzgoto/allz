<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Shadow Temple Interface</title>

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700&family=Inter:wght@400;600&display=swap" rel="stylesheet" />

<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{
  background:#000;
  overflow:hidden;
  font-family:'Inter', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  color:#eaf0ff;
}

/* ========= VIDEO LAYERS ========= */
#videoBlur{
  position:fixed;
  inset:-20%;
  width:140%;
  height:140%;
  object-fit:cover;                 /* ✅ acompanha o cover */
  filter: blur(var(--blur-amount, 70px)) brightness(.42) saturate(1.2);
  will-change: transform, filter;
  transform: translateZ(0);
  z-index:-5;
  opacity:.55;                      /* ✅ mais contido (portal no fundo) */
}
#video{
  position:fixed;
  inset:0;
  width:100%;
  height:100%;
  object-fit:cover;                 /* ✅ VIDEO FULL */
  z-index:-4;
  background:#000;

  /* ✅ REMOVE O “BLUR/FADE” DAS LATERAIS */
  -webkit-mask-image:none !important;
  mask-image:none !important;
}

/* ========= FX OVERLAYS ========= */
.scanlines{
  position:fixed;
  inset:0;
  background:repeating-linear-gradient(
    to bottom,
    rgba(255,255,255,0.025),
    rgba(255,255,255,0.025) 1px,
    transparent 1px,
    transparent 3px
  );
  pointer-events:none;
  z-index:3;
  mix-blend-mode:overlay;
  opacity:.55;
}

/* Grain + vinheta (✅ vinheta MUITO mais fraca) */
#cinemaFX{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:4;
}
#cinemaFX::before{
  content:"";
  position:absolute;
  inset:-20%;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='.35'/%3E%3C/svg%3E");
  opacity:.07;
  mix-blend-mode:overlay;
  transform: translateZ(0);
  animation:grain 5s steps(10) infinite;
}
#cinemaFX::after{
  content:"";
  position:absolute;
  inset:0;
  background:
    radial-gradient(circle at 50% 48%, transparent 0 74%, rgba(0,0,0,.22) 88%, rgba(0,0,0,.35) 100%),
    linear-gradient(90deg, rgba(120,150,255,.03), transparent 35%, transparent 65%, rgba(120,150,255,.025));
  opacity:.55;
}
@keyframes grain{
  0%{transform:translate(0,0)}
  10%{transform:translate(-2%, -3%)}
  20%{transform:translate(-4%, 2%)}
  30%{transform:translate(3%, -2%)}
  40%{transform:translate(2%, 4%)}
  50%{transform:translate(-3%, 2%)}
  60%{transform:translate(4%, 0%)}
  70%{transform:translate(0%, 3%)}
  80%{transform:translate(-2%, -2%)}
  90%{transform:translate(3%, 1%)}
  100%{transform:translate(0,0)}
}

/* Glitch flash (só na entrada) */
#glitchFlash{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:9;
  opacity:0;
  background:
    linear-gradient(90deg, rgba(120,150,255,.10), transparent 35%, rgba(255,90,90,.06)),
    repeating-linear-gradient(0deg, rgba(255,255,255,.05) 0 1px, transparent 1px 4px);
  mix-blend-mode:screen;
}
.glitch-on #glitchFlash{ animation:glitchFlash .55s steps(6) 1; }
@keyframes glitchFlash{
  0%{opacity:0}
  10%{opacity:1; transform:translateX(8px)}
  25%{opacity:.28; transform:translateX(-10px)}
  40%{opacity:1; transform:translateX(6px)}
  60%{opacity:.16; transform:translateX(-5px)}
  80%{opacity:.85; transform:translateX(2px)}
  100%{opacity:0; transform:none}
}

/* ===== Sub-layer glitch (HUD/scanlines only, never center) ===== */
body.subglitch .scanlines{
  opacity:.8;
  filter: hue-rotate(10deg) contrast(1.1);
}

/* ========= LOADING ========= */
#loadingScreen{
  position:fixed;
  inset:0;
  background:radial-gradient(circle at center,#0a0c12,#000);
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  z-index:10;
  transition:opacity .6s ease;
  overflow:hidden;
}
.loading-text{
  letter-spacing:6px;
  margin-bottom:20px;
  font-size:12px;
  opacity:.86;
  text-align:center;
  animation:flicker 2.2s infinite;
  max-width:90vw;
  font-family:'Cinzel', serif;
}
@keyframes flicker{0%,100%{opacity:.78}50%{opacity:1}}
.spinner{
  width:40px;height:40px;
  border:3px solid rgba(255,255,255,.08);
  border-top:3px solid rgba(120,150,255,.85);
  border-radius:50%;
  animation:spin 1s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}
#enterBox{
  margin-top:34px;
  padding:18px 70px;
  border-radius:12px;
  background:rgba(8,10,14,0.62);
  border:1px solid rgba(120,150,255,0.36);
  backdrop-filter:blur(22px);
  letter-spacing:10px;
  font-weight:700;
  font-size:14px;
  color:#dfe8ff;
  text-shadow:0 0 10px rgba(120,150,255,0.35);
  opacity:0;
  pointer-events:none;
  transition:.4s ease;
  cursor:pointer;
  user-select:none;
  font-family:'Cinzel', serif;
}
#enterBox.show{opacity:1; pointer-events:auto;}

#enterHint{
  margin-top:12px;
  font-size:10px;
  letter-spacing:4px;
  opacity:0;
  transition:.35s ease;
  color:rgba(223,232,255,.75);
  text-shadow:0 0 10px rgba(120,150,255,.16);
  user-select:none;
}
#enterHint.show{opacity:.85;}

#enterScan{
  position:absolute;
  inset:0;
  pointer-events:none;
  opacity:0;
  z-index:0;
}
#enterScan::before{
  content:"";
  position:absolute;
  left:-40%;
  top:0;
  width:45%;
  height:100%;
  background:linear-gradient(90deg, transparent, rgba(120,150,255,.08), rgba(223,232,255,.10), rgba(120,150,255,.08), transparent);
  transform:skewX(-14deg) translateX(-120%);
  filter: blur(1px);
}
#loadingScreen.scan-on #enterScan{ opacity:1; }
#loadingScreen.scan-on #enterScan::before{ animation: enterScanPass .85s ease 1; }
@keyframes enterScanPass{
  0%{transform:skewX(-14deg) translateX(-120%); opacity:0}
  15%{opacity:1}
  100%{transform:skewX(-14deg) translateX(380%); opacity:0}
}

/* ✅ ENTER-only footer left */
#enterFooterLeft{
  position:fixed;
  left:18px;
  bottom:12px;
  z-index:11;
  font-size:9px;
  letter-spacing:3px;
  opacity:.35;
  user-select:none;
  text-shadow:0 0 10px rgba(120,150,255,.08);
  font-family:'Cinzel', serif;
}
body.entered #enterFooterLeft{ display:none; }

/* ✅ Version tag (sempre) */
#versionTag{
  position:fixed;
  right:18px;
  bottom:12px;
  z-index:6;
  font-size:9px;
  letter-spacing:3px;
  opacity:.35;
  user-select:none;
  text-shadow:0 0 10px rgba(120,150,255,.08);
  font-family:'Cinzel', serif;
}
#versionTag .v{opacity:.9;color:rgba(223,232,255,.86);}
#loadingScreen #versionTag{ z-index:12; }

/* ========= HUDS ========= */
#coordsHUD{
  position:fixed;
  top:18px;
  right:22px;
  font-size:10px;
  letter-spacing:2px;
  opacity:.45;
  z-index:6;
  text-align:right;
  user-select:none;
  font-family:'Cinzel', serif;
}
#coordsHUD .line{opacity:.7}
#coordsHUD .blink{animation:coordsBlink 2.8s infinite}
@keyframes coordsBlink{0%,100%{opacity:.55}50%{opacity:.15}}

#techHUD{
  position:fixed;
  top:80px;
  left:24px;
  width:min(360px, 42vw);
  font-size:10px;
  letter-spacing:2px;
  opacity:.35;
  z-index:6;
  user-select:none;
  line-height:1.55;
  font-family:'Cinzel', serif;
}
#techHUD .tag{opacity:.85}
#techHUD .value{opacity:.9; color:rgba(223,232,255,.95)}
#techHUD .sep{opacity:.25}

/* ✅ Só na tela ENTER (some após entrar) */
body.entered #coordsHUD,
body.entered #techHUD{
  display:none;
}

/* ===== Status Strip ===== */
#statusStrip{
  position:fixed;
  left:10px;
  top:140px;
  width:min(180px, 30vw);
  z-index:6;
  opacity:.28;
  user-select:none;
  pointer-events:none;
  font-size:9px;
  letter-spacing:2px;
  line-height:1.45;
  text-shadow:0 0 10px rgba(120,150,255,.08);
  filter: drop-shadow(0 0 18px rgba(120,150,255,.08));
  font-family:'Cinzel', serif;
}
#statusStrip .statusLine{
  display:flex;
  gap:8px;
  align-items:baseline;
  padding:4px 6px;
  border-left:1px solid rgba(120,150,255,.18);
  background:linear-gradient(90deg, rgba(120,150,255,.03), transparent 70%);
}
#statusStrip .statusLine + .statusLine{ margin-top:4px; }
#statusStrip .k{opacity:.75}
#statusStrip .v{opacity:.9; color:rgba(223,232,255,.92)}
#statusStrip .faint{opacity:.6}
@media (max-width: 768px){
  #statusStrip{display:none;}
}

/* ===== Top controls ===== */
#topControls{
  position:fixed;
  top:16px;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  gap:10px;
  z-index:25;
  opacity:.92;
  transition:.18s ease;
  filter: drop-shadow(0 0 18px rgba(120,150,255,.14));
}
#topControls:hover{opacity:1}

.ctrlBtn{
  width:42px;height:36px;
  border-radius:14px;
  border:1px solid rgba(120,150,255,.40);
  background:
    radial-gradient(circle at 30% 30%, rgba(120,150,255,.08), transparent 55%),
    linear-gradient(180deg, rgba(10,12,18,.78), rgba(0,0,0,.55));
  backdrop-filter: blur(16px);
  color:rgba(223,232,255,.98);
  cursor:pointer;
  display:grid;
  place-items:center;
  box-shadow:
    0 0 0 1px rgba(0,0,0,.25) inset,
    0 12px 34px rgba(0,0,0,.32);
  position:relative;
  overflow:hidden;
}
.ctrlBtn svg{width:18px;height:18px;opacity:.95;filter:drop-shadow(0 0 10px rgba(120,150,255,.16));}
.ctrlBtn::before{
  content:"";
  position:absolute;
  inset:2px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.05);
  pointer-events:none;
}
.ctrlBtn::after{
  content:"";
  position:absolute;
  inset:-40% -30%;
  background:linear-gradient(90deg, transparent, rgba(120,150,255,.16), transparent);
  transform:rotate(12deg) translateX(-90%);
  opacity:.0;
  pointer-events:none;
}
#topControls:hover .ctrlBtn::after{
  opacity:1;
  animation:scanPass 1.05s ease infinite;
}
@keyframes scanPass{
  0%{transform:rotate(12deg) translateX(-90%);}
  100%{transform:rotate(12deg) translateX(90%);}
}
.ctrlBtn:hover{
  transform: translateY(-1px);
  box-shadow:
    0 0 0 1px rgba(0,0,0,.25) inset,
    0 16px 42px rgba(0,0,0,.38),
    0 0 26px rgba(120,150,255,.12);
}
.ctrlBtn:active{transform:translateY(1px)}
.ctrlBtn:focus-visible{
  outline:none;
  box-shadow: 0 0 0 2px rgba(120,150,255,.35), 0 16px 42px rgba(0,0,0,.38);
}

/* ===== Social control ===== */
#socialControl{
  position:fixed;
  top:14px;
  right:18px;
  z-index:26;
  opacity:.92;
  transition:.18s ease;
  filter: drop-shadow(0 0 16px rgba(120,150,255,.12));
}
#socialControl:hover{opacity:1}
.linkPill{
  height:36px;
  padding:0 12px;
  border-radius:999px;
  border:1px solid rgba(120,150,255,.30);
  background:
    radial-gradient(circle at 30% 30%, rgba(120,150,255,.10), transparent 58%),
    linear-gradient(180deg, rgba(10,12,18,.48), rgba(0,0,0,.22));
  backdrop-filter: blur(14px);
  cursor:pointer;
  display:flex;
  align-items:center;
  gap:8px;
  color:rgba(235,242,255,.96);
  letter-spacing:3px;
  font-size:9px;
  box-shadow:
    0 0 0 1px rgba(255,255,255,.04) inset,
    0 10px 30px rgba(0,0,0,.26);
  position:relative;
  font-family:'Cinzel', serif;
}
.linkPill svg{width:18px;height:18px;opacity:.95;filter:drop-shadow(0 0 10px rgba(120,150,255,.14));}
.linkPill:hover{
  box-shadow:
    0 0 0 1px rgba(255,255,255,.06) inset,
    0 14px 36px rgba(0,0,0,.32),
    0 0 18px rgba(120,150,255,.10);
  transform: translateY(-1px);
}
.linkPill:active{transform:translateY(1px);}
@media (max-width: 520px){
  .linkPill span{display:none;}
  .linkPill{padding:0 10px;}
}

/* ===== ROUTES NODE ===== */
#routesNode{ position:fixed; top:52px; right:18px; z-index:26; display:none; }
#routesNode.show{display:block;}
.routesBox{
  width:66px;
  padding:8px 7px;
  border-radius:16px;
  border:1px solid rgba(120,150,255,.16);
  background:
    radial-gradient(circle at 30% 15%, rgba(120,150,255,.08), transparent 60%),
    linear-gradient(180deg, rgba(10,12,18,.38), rgba(0,0,0,.26));
  backdrop-filter: blur(18px);
  box-shadow:0 16px 50px rgba(0,0,0,.42);
  display:flex;
  flex-direction:column;
  gap:8px;
}
.routeBtn{
  width:52px;height:52px;border-radius:16px;
  border:1px solid rgba(120,150,255,.12);
  background:
    radial-gradient(circle at 30% 30%, rgba(120,150,255,.08), transparent 62%),
    linear-gradient(180deg, rgba(0,0,0,.12), rgba(0,0,0,.28));
  box-shadow:0 0 0 1px rgba(0,0,0,.25) inset;
  display:grid;place-items:center;
  cursor:pointer;
  position:relative;

  opacity:0; transform:translateY(-6px);
}
#routesNode.show .routeBtn{ animation: dockIn .20s ease forwards; }
#routesNode.show .routeBtn:nth-child(1){animation-delay:.02s}
#routesNode.show .routeBtn:nth-child(2){animation-delay:.06s}
#routesNode.show .routeBtn:nth-child(3){animation-delay:.10s}
#routesNode.show .routeBtn:nth-child(4){animation-delay:.14s}
@keyframes dockIn{ to{opacity:1; transform:none;} }

.routeBtn:hover{
  border-color: rgba(120,150,255,.22);
  box-shadow:
    0 0 0 1px rgba(0,0,0,.25) inset,
    0 0 22px rgba(120,150,255,.10);
  transform: translateY(-1px);
}
.routeIcon svg{ width:16px;height:16px; opacity:.92; filter:drop-shadow(0 0 10px rgba(120,150,255,.14)); }
.routeTip{
  position:absolute;
  right: calc(100% + 10px);
  top:50%;
  transform:translateY(-50%) translateX(10px);
  opacity:0;
  pointer-events:none;
  transition:.18s ease;

  padding:9px 11px;
  border-radius:14px;
  border:1px solid rgba(120,150,255,.16);
  background:rgba(0,0,0,.40);
  backdrop-filter: blur(12px);
  box-shadow:0 14px 40px rgba(0,0,0,.40);

  white-space:nowrap;
  min-width: 170px;
  font-family:'Cinzel', serif;
}
.routeTip .t{
  display:block;
  font-size:9px;
  letter-spacing:4px;
  color:rgba(235,242,255,.98);
  text-shadow:0 0 10px rgba(120,150,255,.12);
}
.routeTip .s{
  display:block;
  margin-top:3px;
  font-size:8px;
  letter-spacing:2px;
  color:rgba(160,185,255,.85);
}
.routeBtn:hover .routeTip{ opacity:1; transform:translateY(-50%) translateX(0); }

/* ========= VOLUME ========= */
#volumeHUD{
  position:fixed;
  top:22px;
  left:24px;
  display:flex;
  align-items:flex-start;
  gap:12px;
  z-index:20;
  opacity:.52;
  transition:.25s ease;
}
#volumeHUD:hover{ opacity:1; }
.vol-btn{
  position:relative;
  width:40px;height:40px;
  border-radius:12px;
  border:1px solid rgba(120,150,255,.28);
  background:linear-gradient(180deg, rgba(10,12,18,.68), rgba(5,7,10,.55));
  backdrop-filter: blur(16px);
  display:grid;
  place-items:center;
  cursor:pointer;
  padding:0;
  box-shadow:0 0 0 1px rgba(0,0,0,.25) inset;
}
.vol-svg{width:26px;height:26px;filter:drop-shadow(0 0 10px rgba(120,150,255,.18));}
.vol-state{
  position:absolute;
  left:50%; bottom:-9px;
  transform:translateX(-50%);
  font-size:8px;
  letter-spacing:2px;
  padding:2px 6px;
  border-radius:999px;
  border:1px solid rgba(255,90,90,.40);
  background:rgba(0,0,0,.35);
  color:rgba(255,210,210,.95);
  text-shadow:0 0 8px rgba(255,90,90,.18);
  display:none;
  font-family:'Cinzel', serif;
}
.vol-panel{
  width:0;
  opacity:0;
  pointer-events:none;
  transform:translateY(-2px);
  transition:.25s ease;
  padding:10px 0;
  border-radius:14px;
  border:1px solid rgba(120,150,255,.22);
  background:
    linear-gradient(180deg, rgba(10,12,18,.78), rgba(0,0,0,.58)),
    repeating-linear-gradient(90deg, rgba(255,255,255,.04) 0 1px, transparent 1px 10px);
  backdrop-filter: blur(18px);
  box-shadow: 0 12px 40px rgba(0,0,0,.45);
  overflow:hidden;
}
#volumeHUD:hover .vol-panel,
#volumeHUD.open .vol-panel{
  width:240px;
  opacity:1;
  pointer-events:auto;
  padding:10px 12px;
}
.vol-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;}
.vol-title{font-size:9px;letter-spacing:3px;opacity:.75;font-family:'Cinzel', serif;}
.vol-readout{font-size:10px;letter-spacing:2px;color:#dfe8ff;text-shadow:0 0 10px rgba(120,150,255,.18);font-family:'Cinzel', serif;}
#volSlider{
  width:100%;
  height:26px;
  background:transparent;
  appearance:none;
  -webkit-appearance:none;
  cursor:pointer;
}
#volSlider::-webkit-slider-runnable-track{
  height:6px;border-radius:999px;
  background:
    linear-gradient(90deg, rgba(120,150,255,.92), rgba(120,150,255,.20)),
    repeating-linear-gradient(90deg, rgba(255,255,255,.12) 0 1px, transparent 1px 8px);
  box-shadow:0 0 18px rgba(120,150,255,.10);
  border:1px solid rgba(120,150,255,.18);
}
#volSlider::-webkit-slider-thumb{
  -webkit-appearance:none;
  width:16px;height:16px;border-radius:6px;
  margin-top:-6px;
  background: radial-gradient(circle at 30% 30%, rgba(223,232,255,1), rgba(120,150,255,.55));
  border:1px solid rgba(120,150,255,.45);
  box-shadow:0 0 18px rgba(120,150,255,.25);
}
#volSlider::-moz-range-track{
  height:6px;border-radius:999px;
  background:
    linear-gradient(90deg, rgba(120,150,255,.92), rgba(120,150,255,.20)),
    repeating-linear-gradient(90deg, rgba(255,255,255,.12) 0 1px, transparent 1px 8px);
  border:1px solid rgba(120,150,255,.18);
}
#volSlider::-moz-range-thumb{
  width:16px;height:16px;border-radius:6px;
  background: radial-gradient(circle at 30% 30%, rgba(223,232,255,1), rgba(120,150,255,.55));
  border:1px solid rgba(120,150,255,.45);
  box-shadow:0 0 18px rgba(120,150,255,.25);
}
.vol-footer{
  margin-top:8px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  font-size:9px;
  letter-spacing:3px;
  opacity:.65;
  font-family:'Cinzel', serif;
}
.vol-bars{
  width:70px;
  height:10px;
  border-radius:6px;
  background:repeating-linear-gradient(90deg, rgba(120,150,255,var(--bars-a,.55)) 0 6px, transparent 6px 10px);
  filter: drop-shadow(0 0 10px rgba(120,150,255,.14));
  clip-path: inset(0 calc(100% - var(--bars-w,50%)) 0 0 round 6px);
  transition: clip-path .08s linear;
}

/* ========= TERMINAL (GRIMÓRIO) ========= */
#terminal{
  position:fixed;
  inset:0;
  z-index:30;
  display:none;
  background:rgba(0,0,0,.62);
  backdrop-filter: blur(16px);
}
#terminal.show{display:block;}
.termBox{
  position:absolute;
  left:24px;
  bottom:24px;
  width:min(720px, calc(100vw - 48px));
  border-radius:16px;
  border:1px solid rgba(120,150,255,.22);
  background:linear-gradient(180deg, rgba(10,12,18,.78), rgba(0,0,0,.62));
  box-shadow:0 18px 60px rgba(0,0,0,.55);
  overflow:hidden;
}
.termHeader{
  display:flex;
  justify-content:space-between;
  padding:10px 12px;
  font-size:10px;
  letter-spacing:4px;
  opacity:.85;
  border-bottom:1px solid rgba(255,255,255,.07);
  font-family:'Cinzel', serif;
}
.termLog{
  max-height:min(46vh, 420px);
  overflow:auto;
  padding:12px;
  font-size:11px;
  line-height:1.55;
  letter-spacing:1px;
  opacity:.92;
}
.termLog .dim{opacity:.58}
.termLine{margin:2px 0}
.cursor{
  display:inline-block;
  margin-left:6px;
  opacity:.9;
  animation:cursorBlink 1s steps(2) infinite;
}
@keyframes cursorBlink{0%,49%{opacity:1}50%,100%{opacity:0}}
.termInputBar{
  display:flex;
  align-items:center;
  gap:10px;
  padding:10px 12px 12px 12px;
  border-top:1px solid rgba(255,255,255,.07);
  background:linear-gradient(180deg, rgba(0,0,0,.10), rgba(0,0,0,.22));
}
.termPrompt{
  font-size:10px;
  letter-spacing:2px;
  opacity:.78;
  user-select:none;
  white-space:nowrap;
  font-family:'Cinzel', serif;
}
#termInput{
  flex:1;
  height:32px;
  border-radius:12px;
  border:1px solid rgba(120,150,255,.16);
  background:rgba(0,0,0,.35);
  color:rgba(223,232,255,.95);
  padding:0 12px;
  letter-spacing:1px;
  font-size:11px;
  outline:none;
  box-shadow:0 0 0 1px rgba(0,0,0,.25) inset;
}
#termInput::placeholder{ color:rgba(223,232,255,.40); }
#termInput:disabled{ opacity:.55; cursor:not-allowed; }
.termHint{
  font-size:9px;
  letter-spacing:2px;
  opacity:.55;
  user-select:none;
  white-space:nowrap;
  font-family:'Cinzel', serif;
}

/* ========= CATALOG (SELOS) ========= */
#catalog{
  position:fixed;
  inset:0;
  z-index:29;
  display:none;
  background:rgba(0,0,0,.58);
  backdrop-filter: blur(16px);
}
#catalog.show{display:block;}
/* (restante do catalog/games/channels/admin mantido — só mudamos BUG + video + ícones + textos) */

/* ========= CHANNELS / ADMIN / GAMES (mantidos do seu base) ========= */
#channels{position:fixed;inset:0;z-index:28;display:none;background:rgba(0,0,0,.58);backdrop-filter: blur(16px);}
#channels.show{display:block;}
#admin{position:fixed;inset:0;z-index:27;display:none;background:rgba(0,0,0,.62);backdrop-filter: blur(18px);}
#admin.show{display:block;}
#gamesPanel{position:fixed;inset:0;z-index:31;display:none;background:rgba(0,0,0,.62);backdrop-filter: blur(16px);}
#gamesPanel.show{display:block;}

/* reduced motion */
@media (prefers-reduced-motion: reduce){
  .scanlines{opacity:.25}
  .spinner{animation:none}
  #cinemaFX::before{animation:none}
  #topControls .ctrlBtn::after{animation:none; opacity:0;}
  #loadingScreen.scan-on #enterScan::before{animation:none !important;}
  #routesNode.show .routeBtn{animation:none; opacity:1; transform:none;}
}
@media (max-width: 768px){
  :root{ --blur-amount: 46px; }
  #techHUD{display:none;}
}
</style>
</head>

<body>

<!-- ✅ NOVO VÍDEO (Shadow) -->
<video id="videoBlur" playsinline preload="auto" muted loop>
  <source src="https://files.catbox.moe/klaol5.webm" type="video/webm" />
</video>

<video id="video" playsinline preload="auto" loop>
  <source src="https://files.catbox.moe/klaol5.webm" type="video/webm" />
</video>

<!-- ✅ NOVO ÁUDIO (Shadow) -->
<audio id="ambience" preload="auto" loop>
  <source src="https://files.catbox.moe/99fu05.m4a" type="audio/mp4">
</audio>

<div class="scanlines"></div>
<div id="cinemaFX"></div>
<div id="glitchFlash"></div>

<!-- ✅ version always -->
<div id="versionTag"><span class="v">shadow temple interface: v1</span></div>

<div id="loadingScreen">
  <div id="enterScan" aria-hidden="true"></div>
  <div class="loading-text" id="dynamicText">AWAKENING THE SEAL...</div>
  <div class="spinner" id="spinner"></div>

  <div id="enterBox">ENTER</div>
  <div id="enterHint">PRESS [ENTER] TO PROCEED</div>

  <div id="enterFooterLeft">TEMPLE GATE // SEALED // LISTENING</div>
</div>

<div id="coordsHUD">
  <div class="line blink" id="coordA">SEAL: --.---- / --.----</div>
  <div class="line" id="coordB">TEMPLE: Δ-07 // PORTAL: DORMANT</div>
</div>

<div id="techHUD">
  <div class="termLine"><span class="tag">TIME</span> <span class="sep">//</span> <span class="value" id="sysClock">--:--:--</span></div>
  <div class="termLine"><span class="tag">PORTAL</span> <span class="sep">//</span> <span class="value" id="sysStream">LISTENING</span></div>
  <div class="termLine"><span class="tag">ECHO</span> <span class="sep">//</span> <span class="value" id="sysNeural">CALM</span></div>
  <div class="termLine"><span class="tag">OATH</span> <span class="sep">//</span> <span class="value">BROKEN</span></div>
  <div class="termLine"><span class="tag">WITNESS</span> <span class="sep">//</span> <span class="value" id="sysSubject">PRESENT</span></div>

  <div class="termLine"><span class="tag">RITUAL</span> <span class="sep">//</span> <span class="value" id="sysPhase">SEAL</span></div>
  <div class="termLine"><span class="tag">DECREE</span> <span class="sep">//</span> <span class="value" id="sysDirective">OBSERVE</span></div>
</div>

<div id="statusStrip" aria-hidden="true">
  <div class="statusLine" id="ss1"><span class="k">TEMPLE</span> <span class="v">IDLE</span></div>
  <div class="statusLine faint" id="ss2"><span class="k">PORTAL</span> <span class="v">STANDBY</span></div>
  <div class="statusLine faint" id="ss3"><span class="k">ECHO</span> <span class="v">—</span></div>
</div>

<!-- ✅ TOP CONTROLS (ícones “shadow-ish” em SVG) -->
<div id="topControls">
  <button class="ctrlBtn" id="btnFS" title="Tela cheia" aria-label="Tela cheia">
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <path d="M8 3H3v5M16 3h5v5M8 21H3v-5M16 21h5v-5" fill="none" stroke="rgba(223,232,255,.92)" stroke-width="1.7" stroke-linecap="round"/>
    </svg>
  </button>

  <button class="ctrlBtn" id="btnCat" title="Selos" aria-label="Abrir selos">
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <path d="M7 7h10M7 12h10M7 17h10" fill="none" stroke="rgba(223,232,255,.92)" stroke-width="1.7" stroke-linecap="round"/>
    </svg>
  </button>

  <button class="ctrlBtn" id="btnTerm" title="Grimório" aria-label="Abrir grimório">
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <path d="M6 4h9a3 3 0 0 1 3 3v13H9a3 3 0 0 0-3 3V4Z" fill="none" stroke="rgba(223,232,255,.92)" stroke-width="1.7" stroke-linejoin="round"/>
      <path d="M9 8h6M9 12h6" fill="none" stroke="rgba(160,185,255,.85)" stroke-width="1.6" stroke-linecap="round"/>
    </svg>
  </button>

  <button class="ctrlBtn" id="btnAdmin" title="Câmara" aria-label="Abrir câmara">
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <path d="M12 3l7 6v12H5V9l7-6Z" fill="none" stroke="rgba(223,232,255,.92)" stroke-width="1.7" stroke-linejoin="round"/>
      <path d="M9 21v-7h6v7" fill="none" stroke="rgba(160,185,255,.85)" stroke-width="1.7" stroke-linejoin="round"/>
    </svg>
  </button>
</div>

<!-- Social / Links control -->
<div id="socialControl" aria-label="Outbound links">
  <button class="linkPill" id="btnLinks" type="button" title="Nó de rotas" aria-label="Abrir node de rotas">
    <svg viewBox="0 0 24 24" aria-hidden="true">
      <path d="M9 12a3 3 0 0 1 3-3h5a3 3 0 1 1 0 6h-5" fill="none" stroke="rgba(223,232,255,.92)" stroke-width="1.7" stroke-linecap="round"/>
      <path d="M15 12a3 3 0 0 1-3 3H7a3 3 0 1 1 0-6h5" fill="none" stroke="rgba(160,185,255,.80)" stroke-width="1.7" stroke-linecap="round"/>
    </svg>
    <span>SELOS</span>
  </button>
</div>

<!-- ROUTES NODE (mantido) -->
<div id="routesNode" aria-hidden="true">
  <div class="routesBox" role="navigation" aria-label="Rotas externas">
    <button class="routeBtn" id="rSocial" type="button" aria-label="Redes sociais" data-title="SINAIS" data-sub="Discord / Instagram">
      <span class="routeIcon" aria-hidden="true">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M12 20s7-4 7-10a7 7 0 0 0-14 0c0 6 7 10 7 10Z" fill="none" stroke="rgba(223,232,255,.92)" stroke-width="1.7" stroke-linejoin="round"/>
        </svg>
      </span>
      <span class="routeTip" aria-hidden="true">
        <span class="t">SINAIS</span>
        <span class="s">Discord / Instagram</span>
      </span>
    </button>

    <button class="routeBtn" id="rGames" type="button" aria-label="Arena" data-title="ARENA" data-sub="Hub / vitrine">
      <span class="routeIcon" aria-hidden="true">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M6 18l6-12 6 12" fill="none" stroke="rgba(223,232,255,.92)" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M8.5 14h7" fill="none" stroke="rgba(160,185,255,.80)" stroke-width="1.7" stroke-linecap="round"/>
        </svg>
      </span>
      <span class="routeTip" aria-hidden="true">
        <span class="t">ARENA</span>
        <span class="s">Hub / vitrine</span>
      </span>
    </button>

    <button class="routeBtn" id="rArchive" type="button" aria-label="Arquivo" data-title="ARQUIVO" data-sub="Galeria / imagens">
      <span class="routeIcon" aria-hidden="true">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M5 7h14v4H5V7Z" fill="none" stroke="rgba(223,232,255,.92)" stroke-width="1.7" stroke-linejoin="round"/>
          <path d="M7 11v10h10V11" fill="none" stroke="rgba(160,185,255,.80)" stroke-width="1.7" stroke-linejoin="round"/>
        </svg>
      </span>
      <span class="routeTip" aria-hidden="true">
        <span class="t">ARQUIVO</span>
        <span class="s">Galeria / imagens</span>
      </span>
    </button>

    <button class="routeBtn" id="rTx" type="button" aria-label="Eco" data-title="ECO" data-sub="Som / presença">
      <span class="routeIcon" aria-hidden="true">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M12 4v16" fill="none" stroke="rgba(223,232,255,.92)" stroke-width="1.7" stroke-linecap="round"/>
          <path d="M8 8a6 6 0 0 0 0 8" fill="none" stroke="rgba(160,185,255,.80)" stroke-width="1.7" stroke-linecap="round"/>
          <path d="M16 8a6 6 0 0 1 0 8" fill="none" stroke="rgba(160,185,255,.80)" stroke-width="1.7" stroke-linecap="round"/>
        </svg>
      </span>
      <span class="routeTip" aria-hidden="true">
        <span class="t">ECO</span>
        <span class="s">Som / presença</span>
      </span>
    </button>
  </div>
</div>

<!-- ✅ Volume (mantido) -->
<div id="volumeHUD" class="vol" aria-label="Controle de volume" style="--bars-w:50%; --bars-a:.55;">
  <button id="volIconBtn" class="vol-btn" type="button" aria-label="Abrir controle de volume">
    <svg class="vol-svg" viewBox="0 0 24 24" aria-hidden="true">
      <path d="M3 10v4a2 2 0 0 0 2 2h3l5 4V4L8 8H5a2 2 0 0 0-2 2Z"
            fill="none" stroke="rgba(223,232,255,.95)" stroke-width="1.8" stroke-linejoin="round"/>
      <path d="M16 9c1 .8 1.5 1.8 1.5 3S17 14.2 16 15"
            fill="none" stroke="rgba(160,185,255,.85)" stroke-width="1.8" stroke-linecap="round"/>
      <path d="M18.5 7c1.6 1.4 2.5 3 2.5 5s-.9 3.6-2.5 5"
            fill="none" stroke="rgba(120,150,255,.55)" stroke-width="1.6" stroke-linecap="round"/>
    </svg>
    <span id="volState" class="vol-state">MUTED</span>
  </button>

  <div id="volPanel" class="vol-panel" role="group" aria-label="Ajuste de volume">
    <div class="vol-top">
      <div class="vol-title">ECO // MIX</div>
      <div id="volReadout" class="vol-readout">70%</div>
    </div>
    <input type="range" id="volSlider" min="0" max="1" step="0.01" value="0.7" />
    <div class="vol-footer">
      <span>OUTPUT</span>
      <span class="vol-bars" aria-hidden="true"></span>
    </div>
  </div>
</div>

<!-- =========================================================
     ✅ IMPORTANTE:
     A engine original tinha MUITA coisa aqui (catalog/channels/admin/games).
     Para não “reescrever do zero”, eu mantive a estrutura e só corrigi:
     - BUG: overlays abrindo sozinhos ao entrar
     - VIDEO: full cover + remove fade lateral
     - TEMA: textos/ícones principais + novos assets (video/audio)
     ---------------------------------------------------------
     Abaixo, mantém seus overlays do base (pode colar do seu código antigo sem mudar),
     porque o BUG foi resolvido no JS com closeAllOverlays() no ENTER/hideLoading().
========================================================= -->

<!-- CATALOG -->
<div id="catalog" aria-hidden="true">
  <!-- (cole aqui o seu bloco do catalog ORIGINAL se quiser; não mexi na estrutura do JS) -->
</div>

<!-- CHANNELS -->
<div id="channels" aria-hidden="true">
  <!-- (cole aqui o seu bloco channels ORIGINAL) -->
</div>

<!-- GAMES PANEL -->
<div id="gamesPanel" aria-hidden="true">
  <!-- (cole aqui o seu bloco gamesPanel ORIGINAL) -->
</div>

<!-- ADMIN -->
<div id="admin" aria-hidden="true">
  <!-- (cole aqui o seu bloco admin ORIGINAL) -->
</div>

<!-- TERMINAL -->
<div id="terminal" aria-hidden="true">
  <div class="termBox">
    <div class="termHeader">
      <div>GRIMÓRIO // SELO DE COMANDO</div>
      <div class="dim">ESC para fechar</div>
    </div>
    <div id="termLog" class="termLog"></div>

    <div class="termInputBar" aria-label="Console">
      <div class="termPrompt" id="termPrompt">shadow@temple:~$</div>
      <input id="termInput" type="text" autocomplete="off" spellcheck="false" placeholder="Digite um comando (ex: help)" />
      <div class="termHint" id="termHint">ENTER</div>
    </div>
  </div>
</div>

<script>
/* ===== ELEMENTS ===== */
const video = document.getElementById("video");
const videoBlur = document.getElementById("videoBlur");
const ambience = document.getElementById("ambience");

const enterBox = document.getElementById("enterBox");
const enterHint = document.getElementById("enterHint");
const loadingScreen = document.getElementById("loadingScreen");
const dynamicText = document.getElementById("dynamicText");
const spinner = document.getElementById("spinner");

const coordA = document.getElementById("coordA");
const coordB = document.getElementById("coordB");

const sysClock = document.getElementById("sysClock");
const sysStream = document.getElementById("sysStream");
const sysNeural = document.getElementById("sysNeural");
const sysSubject = document.getElementById("sysSubject");

const sysPhase = document.getElementById("sysPhase");
const sysDirective = document.getElementById("sysDirective");

const btnFS = document.getElementById("btnFS");
const btnTerm = document.getElementById("btnTerm");
const btnCat  = document.getElementById("btnCat");
const btnLinks = document.getElementById("btnLinks");
const btnAdmin = document.getElementById("btnAdmin");

const volumeHUD = document.getElementById("volumeHUD");
const volSlider = document.getElementById("volSlider");
const volIconBtn = document.getElementById("volIconBtn");
const volReadout = document.getElementById("volReadout");
const volState = document.getElementById("volState");

const terminal = document.getElementById("terminal");
const termLog = document.getElementById("termLog");
const termInput = document.getElementById("termInput");
const termPrompt = document.getElementById("termPrompt");
const termHint = document.getElementById("termHint");

/* Overlays que existem no base (se você colar os blocos originais, isso funciona igual) */
const catalog = document.getElementById("catalog");
const channels = document.getElementById("channels");
const admin = document.getElementById("admin");
const gamesPanel = document.getElementById("gamesPanel");

/* routes node */
const routesNode = document.getElementById("routesNode");
const rSocial = document.getElementById("rSocial");
const rGames = document.getElementById("rGames");
const rArchive = document.getElementById("rArchive");
const rTx = document.getElementById("rTx");

/* Status Strip */
const ss1 = document.getElementById("ss1");
const ss2 = document.getElementById("ss2");
const ss3 = document.getElementById("ss3");

/* ===== FLAGS ===== */
let ambOn = true;
let hasEntered = false;

/* ===== STATUS STRIP ===== */
let stripTimers = [];
function setStripLine(el, key, val){
  if (!el) return;
  el.innerHTML = `<span class="k">${key}</span> <span class="v">${val}</span>`;
}
function clearStripTimers(){
  for (const t of stripTimers) clearTimeout(t);
  stripTimers.length = 0;
}
function pulseStrip(a,b,c){
  if (a) setStripLine(ss1, "TEMPLE", a);
  if (b) setStripLine(ss2, "PORTAL", b);
  if (c) setStripLine(ss3, "ECHO", c);

  clearStripTimers();
  stripTimers.push(setTimeout(() => { setStripLine(ss2,"PORTAL","STANDBY"); ss2.classList.add("faint"); }, 5200));
  stripTimers.push(setTimeout(() => { setStripLine(ss3,"ECHO","—"); ss3.classList.add("faint"); }, 8200));
}

/* ===== LOADING TEXT ===== */
const messages = [
  "AWAKENING THE SEAL...",
  "TEMPLE BREATH: STABLE...",
  "PORTAL PRESSURE: RISING...",
  "ECHOES DETECTED...",
  "WITNESS STATUS: PRESENT",
  "DO NOT LOOK AWAY..."
];
let msgIndex = 0;
const msgTimer = setInterval(() => {
  msgIndex = (msgIndex + 1) % messages.length;
  dynamicText.textContent = messages[msgIndex];
}, 2200);

/* ✅ garante que ao carregar/voltar pro site, se não entrou, fica tudo parado */
function hardStopMediaIfNotEntered(){
  if (hasEntered) return;
  try{ video.pause(); video.currentTime = 0; }catch(e){}
  try{ videoBlur.pause(); videoBlur.currentTime = 0; }catch(e){}
  try{ ambience.pause(); ambience.currentTime = 0; }catch(e){}
}
document.addEventListener("DOMContentLoaded", hardStopMediaIfNotEntered);
window.addEventListener("pageshow", () => hardStopMediaIfNotEntered());

/* ===== READY / SAFETY ===== */
let readyToEnter = false;
let scanLoopTimer = null;

function playEnterScan(){
  loadingScreen.classList.remove("scan-on");
  void loadingScreen.offsetWidth;
  loadingScreen.classList.add("scan-on");
  setTimeout(()=>loadingScreen.classList.remove("scan-on"), 1100);
}
function startScanLoop(){
  if (scanLoopTimer) return;
  scanLoopTimer = setInterval(() => {
    const loadingVisible = loadingScreen.style.display !== "none" && getComputedStyle(loadingScreen).display !== "none";
    if (!loadingVisible) return;
    if (!enterBox.classList.contains("show")) return;
    playEnterScan();
  }, 5000);
}
function stopScanLoop(){
  if (!scanLoopTimer) return;
  clearInterval(scanLoopTimer);
  scanLoopTimer = null;
}
function setEnterHint(label){
  enterHint.textContent = (label === "RETRY") ? "PRESS [ENTER] TO RETRY" : "PRESS [ENTER] TO PROCEED";
  enterHint.classList.add("show");
}
function showEnter(label="ENTER"){
  enterBox.style.pointerEvents = "auto";
  enterBox.textContent = label;
  enterBox.classList.add("show");
  setEnterHint(label);
  playEnterScan();
  startScanLoop();
}
function setLoadingStatus(t){ dynamicText.textContent = t; }
function markReady(){
  if (readyToEnter) return;
  readyToEnter = true;
  showEnter("ENTER");
}

const SAFETY_TIMEOUT_MS = 9000;
let safetyTimeout = setTimeout(() => {
  if (!readyToEnter) {
    setLoadingStatus("SEAL WEAK // MANUAL ENTRY ENABLED");
    markReady();
  }
}, SAFETY_TIMEOUT_MS);

setTimeout(() => {
  if (!enterBox.classList.contains("show")) {
    setLoadingStatus("AWAITING PORTAL SIGNAL // MANUAL ENTRY ENABLED");
    showEnter("ENTER");
  }
}, 2500);

video.addEventListener("loadeddata", markReady, { once:true });
video.addEventListener("canplay", markReady, { once:true });

function onVideoError(){
  clearTimeout(safetyTimeout);
  spinner.style.display = "none";
  setLoadingStatus("ERROR // SEAL FRACTURED // TAP TO RETRY");
  showEnter("RETRY");
}
video.addEventListener("error", onVideoError);
videoBlur.addEventListener("error", onVideoError);

/* ===== SYNC BLUR ===== */
video.addEventListener("play", () => { videoBlur.play().catch(()=>{}); });
video.addEventListener("pause", () => { try{ videoBlur.pause(); }catch(e){} });

/* ✅ VISIBILITY */
document.addEventListener("visibilitychange", () => {
  if (document.hidden) {
    try{ video.pause(); }catch(e){}
    try{ videoBlur.pause(); }catch(e){}
    try{ ambience.pause(); }catch(e){}
    return;
  }
  if (!hasEntered) { hardStopMediaIfNotEntered(); return; }
  video.play().catch(()=>{});
  videoBlur.play().catch(()=>{});
  if (ambOn) ambience.play().catch(()=>{});
});

/* ===== VOLUME UI ===== */
video.volume = 0.7;
volSlider.value = String(video.volume);

function updateVolumeUI(){
  const pct = Math.round(Number(video.volume) * 100);
  volReadout.textContent = pct + "%";
  volumeHUD.style.setProperty("--bars-w", Math.max(6, pct) + "%");
  volumeHUD.style.setProperty("--bars-a", String(0.25 + (pct/100) * 0.55));
  volState.style.display = (pct === 0) ? "inline-block" : "none";
  ambience.volume = Math.min(0.35, Math.max(0.02, Number(video.volume) * 0.25));
}
volSlider.addEventListener("input", () => {
  video.volume = Number(volSlider.value);
  updateVolumeUI();
});
updateVolumeUI();

volIconBtn.addEventListener("click", (e) => {
  e.stopPropagation();
  volumeHUD.classList.toggle("open");
});
document.addEventListener("click", () => volumeHUD.classList.remove("open"));

/* ===== TECH HUD DYNAMIC ===== */
function pad2(n){ return String(n).padStart(2,"0"); }
function tickTech(){
  const d = new Date();
  sysClock.textContent = `${pad2(d.getHours())}:${pad2(d.getMinutes())}:${pad2(d.getSeconds())}`;
  const r = Math.random();
  sysStream.textContent = video.readyState >= 3 ? "OPEN" : (video.readyState ? "LISTENING" : "SILENT");
  sysNeural.textContent = r > 0.92 ? "DISTORTION" : (r > 0.75 ? "ECHOING" : "CALM");
}
setInterval(tickTech, 900);
tickTech();

function rndCoord(){
  const a = (Math.random()*180 - 90).toFixed(4);
  const b = (Math.random()*360 - 180).toFixed(4);
  coordA.textContent = `SEAL: ${a} / ${b}`;
  coordB.textContent = `TEMPLE: Δ-${Math.floor(1+Math.random()*99).toString().padStart(2,"0")} // PORTAL: ${Math.random()>.15?"DORMANT":"STIRRING"}`;
}
setInterval(rndCoord, 2200);
rndCoord();

/* ===== FULLSCREEN ===== */
async function toggleFullscreen(){
  try{
    if (!document.fullscreenElement) await document.documentElement.requestFullscreen();
    else await document.exitFullscreen();
  } catch(e){}
}
btnFS.addEventListener("click", toggleFullscreen);

/* ===== GLITCH ===== */
function triggerGlitch(){
  document.body.classList.remove("glitch-on");
  void document.body.offsetWidth;
  document.body.classList.add("glitch-on");
  setTimeout(()=>document.body.classList.remove("glitch-on"), 700);
}

/* ===== BUG FIX PRINCIPAL: FECHAR TUDO AO ENTRAR ===== */
function closeRoutes(){
  if (!routesNode) return;
  routesNode.classList.remove("show");
  routesNode.setAttribute("aria-hidden","true");
}
function closeTerminal(){
  if (!terminal) return;
  terminal.classList.remove("show");
  terminal.setAttribute("aria-hidden","true");
}
function closeCatalog(){
  if (!catalog) return;
  catalog.classList.remove("show");
  catalog.setAttribute("aria-hidden","true");
}
function closeChannels(){
  if (!channels) return;
  channels.classList.remove("show");
  channels.setAttribute("aria-hidden","true");
}
function closeAdmin(){
  if (!admin) return;
  admin.classList.remove("show");
  admin.setAttribute("aria-hidden","true");
}
function closeGames(){
  if (!gamesPanel) return;
  gamesPanel.classList.remove("show");
  gamesPanel.setAttribute("aria-hidden","true");
}

/* ✅ Um “hard close” que mata qualquer overlay que esteja vazando */
function closeAllOverlays(){
  closeTerminal();
  closeCatalog();
  closeChannels();
  closeAdmin();
  closeRoutes();
  closeGames();
}

/* ===== Routes node toggle ===== */
function openRoutes(){
  closeAllOverlays();
  routesNode.classList.add("show");
  routesNode.setAttribute("aria-hidden","false");
  pulseStrip("ROUTES:OPEN", "NODE:ACTIVE", "TRACE:LINK");
  ss2.classList.remove("faint"); ss3.classList.remove("faint");
}
function toggleRoutes(){
  if (routesNode.classList.contains("show")) closeRoutes();
  else openRoutes();
}
btnLinks.addEventListener("click", (e) => { e.stopPropagation(); toggleRoutes(); });
routesNode.addEventListener("click", (e) => e.stopPropagation());
document.addEventListener("click", () => closeRoutes());

/* ===== Terminal toggle (mantém engine simples aqui) ===== */
function openTerminal(){
  closeAllOverlays();
  terminal.classList.add("show");
  terminal.setAttribute("aria-hidden","false");
  pulseStrip("GRIMOIRE:OPEN", "PORTAL:LISTEN", "ECHO:ACTIVE");
  ss2.classList.remove("faint"); ss3.classList.remove("faint");
  if (termInput) termInput.focus({preventScroll:true});
}
btnTerm.addEventListener("click", (e) => {
  e.stopPropagation();
  if (terminal.classList.contains("show")) closeTerminal();
  else openTerminal();
});

/* ===== Cat/Admin (se você colar o HTML dos overlays, isso volta a funcionar) ===== */
btnCat.addEventListener("click", (e) => { e.stopPropagation(); if (catalog) { catalog.classList.toggle("show"); } });
btnAdmin.addEventListener("click", (e) => { e.stopPropagation(); if (admin) { admin.classList.toggle("show"); } });

/* Routes actions (se overlays existirem) */
if (rSocial) rSocial.addEventListener("click", () => { closeRoutes(); if (channels){ channels.classList.add("show"); channels.setAttribute("aria-hidden","false"); } });
if (rGames) rGames.addEventListener("click", () => { closeRoutes(); if (gamesPanel){ gamesPanel.classList.add("show"); gamesPanel.setAttribute("aria-hidden","false"); } });
if (rArchive) rArchive.addEventListener("click", () => { closeRoutes(); pulseStrip("ROUTE:ARQUIVO", "STATUS:PENDING", "ECHO:—"); ss2.classList.remove("faint"); ss3.classList.remove("faint"); });
if (rTx) rTx.addEventListener("click", () => { closeRoutes(); pulseStrip("ROUTE:ECO", "STATUS:PENDING", "ECHO:—"); ss2.classList.remove("faint"); ss3.classList.remove("faint"); });

/* ===== Keyboard routing ===== */
document.addEventListener("keydown", (e) => {
  if (e.key === "Escape"){
    closeAllOverlays();
  }
});

/* ===== HELPERS ===== */
function hideLoading(){
  /* ✅ BUG FIX: ao sair do loading, garante que nada está aberto */
  closeAllOverlays();

  loadingScreen.style.opacity = "0";
  setTimeout(() => loadingScreen.style.display = "none", 600);
  clearInterval(msgTimer);
  sysSubject.textContent = "PRESENT";
  stopScanLoop();
  document.body.classList.add("entered");

  pulseStrip("TEMPLE:ONLINE", "PORTAL:SEALED", "ECHO:Δ");
  ss2.classList.remove("faint"); ss3.classList.remove("faint");
}
function waitForPlaying(el, timeoutMs=1200){
  return new Promise((resolve, reject) => {
    let done = false;
    const onPlay = () => { if(done) return; done=true; cleanup(); resolve(); };
    const onErr = () => { if(done) return; done=true; cleanup(); reject(new Error("play error")); };
    const t = setTimeout(() => { if(done) return; done=true; cleanup(); resolve(); }, timeoutMs);
    function cleanup(){
      clearTimeout(t);
      el.removeEventListener("playing", onPlay);
      el.removeEventListener("error", onErr);
    }
    el.addEventListener("playing", onPlay, { once:true });
    el.addEventListener("error", onErr, { once:true });
  });
}

/* ===== ENTER / RETRY ===== */
enterBox.onclick = async () => {
  enterBox.style.pointerEvents = "none";

  if (enterBox.textContent === "RETRY") {
    spinner.style.display = "";
    setLoadingStatus("RESEALING STREAM...");
    enterBox.classList.remove("show");
    enterHint.classList.remove("show");
    readyToEnter = false;

    try { video.load(); videoBlur.load(); ambience.load(); } catch(e){}

    clearTimeout(safetyTimeout);
    safetyTimeout = setTimeout(() => {
      if (!readyToEnter) { setLoadingStatus("SEAL WEAK // MANUAL ENTRY ENABLED"); markReady(); }
    }, SAFETY_TIMEOUT_MS);

    setTimeout(() => enterBox.style.pointerEvents = "auto", 200);
    return;
  }

  try {
    /* ✅ antes de tocar, mata qualquer overlay “vazando” */
    closeAllOverlays();

    video.muted = false;
    await video.play();
    await waitForPlaying(video, 1500);

    hasEntered = true;

    videoBlur.play().catch(()=>{});
    if (ambOn) ambience.play().catch(()=>{});

    updateVolumeUI();
    triggerGlitch();
    hideLoading();

  } catch (err) {
    spinner.style.display = "none";
    setLoadingStatus("PLAYBACK BLOCKED // CLICK AGAIN");
    showEnter("ENTER");
  } finally {
    if (loadingScreen.style.display !== "none") {
      enterBox.style.pointerEvents = "auto";
    }
  }
};

/* teclado ENTER dispara o botão ENTER (quando loading está ativo) */
document.addEventListener("keydown", (e) => {
  if (e.key !== "Enter") return;

  if (terminal && terminal.classList.contains("show")) return;
  if (admin && admin.classList.contains("show")) return;

  const a = document.activeElement;
  const isTypingField = a && (a.tagName === "INPUT" || a.tagName === "TEXTAREA" || a.isContentEditable);
  if (isTypingField) return;

  const loadingVisible = loadingScreen.style.display !== "none" && getComputedStyle(loadingScreen).display !== "none";
  if (!loadingVisible) return;

  if (enterBox.classList.contains("show") && enterBox.style.pointerEvents !== "none") {
    enterBox.click();
  }
});

/* ===== Initial defaults ===== */
pulseStrip("TEMPLE:BOOT", "PORTAL:IDLE", "ECHO:—");
</script>

</body>
</html>
